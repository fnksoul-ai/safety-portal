<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì‚¬ì§„ëŒ€ì§€</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#0f1117;--bg2:#171b24;--bg3:#1e2330;--bg4:#252a38;
  --bdr:#2e3448;--m:#64748b;--m2:#94a3b8;
  --or:#f97316;--gn:#22c55e;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg1);color:#e2e8f0;font-family:'Noto Sans KR',sans-serif;height:100vh;overflow:hidden;display:flex;flex-direction:column}
/* â”€ Nav â”€ */
.nav{height:48px;background:var(--bg2);border-bottom:1px solid var(--bdr);display:flex;align-items:center;padding:0 16px;gap:14px;flex-shrink:0;z-index:200}
.logo{font-family:'Bebas Neue',sans-serif;font-size:21px;color:var(--or);letter-spacing:2px;display:flex;align-items:center;gap:7px}
.nav a{color:var(--m2);font-size:13px;text-decoration:none}.nav a:hover{color:#fff}
/* â”€ Toolbar â”€ */
.toolbar{height:50px;background:var(--bg2);border-bottom:1px solid var(--bdr);display:flex;align-items:center;padding:0 12px;gap:7px;flex-shrink:0;overflow-x:auto}
.tl{flex:1;font-size:13px;color:var(--m2);font-weight:600}
.btn{padding:6px 13px;border-radius:7px;font-size:13px;font-family:'Noto Sans KR',sans-serif;cursor:pointer;border:none;font-weight:500;white-space:nowrap;transition:.15s}
.btn.g{background:var(--bg4);color:var(--m2);border:1px solid var(--bdr)}.btn.g:hover{background:var(--bg3);color:#fff}
.btn.g:disabled{opacity:.35;cursor:not-allowed}
.btn.green{background:var(--gn);color:#fff}.btn.green:hover{background:#16a34a}
.btn.orange{background:var(--or);color:#fff}.btn.orange:hover{background:#ea580c}
/* â”€ Fmtbar â”€ */
.fmtbar{height:36px;background:var(--bg3);border-bottom:1px solid var(--bdr);display:flex;align-items:center;padding:0 8px;gap:2px;flex-shrink:0;overflow-x:auto}
.fsep{width:1px;height:16px;background:var(--bdr);margin:0 4px;flex-shrink:0}
.flbl{font-size:10px;color:var(--m);white-space:nowrap;padding:0 2px}
.fb{background:var(--bg4);border:1px solid var(--bdr);color:var(--m2);border-radius:5px;height:22px;cursor:pointer;font-size:12px;font-family:'Noto Sans KR',sans-serif;display:inline-flex;align-items:center;justify-content:center;transition:.1s;white-space:nowrap;line-height:1;padding:0 6px}
.fb:hover{background:var(--bg3);color:#fff;border-color:#4b5563}
.fb.on{background:rgba(249,115,22,.22);color:var(--or);border-color:var(--or)}
.fsel{background:var(--bg4);border:1px solid var(--bdr);color:var(--m2);border-radius:5px;padding:0 4px;height:22px;font-size:12px;cursor:pointer}
.fnum{background:var(--bg4);border:1px solid var(--bdr);color:var(--m2);border-radius:5px;padding:0 4px;height:22px;font-size:12px;width:38px;text-align:center}
.fhint{font-size:10px;color:var(--m);white-space:nowrap;margin-left:4px;flex-shrink:0}
/* â”€ Settings â”€ */
.settings{background:var(--bg3);border-bottom:1px solid var(--bdr);padding:8px 14px;display:flex;align-items:center;gap:14px;flex-shrink:0;flex-wrap:wrap}
.sg{display:flex;flex-direction:column;gap:3px}.sg label{font-size:10px;color:var(--m);font-weight:500}
.sg input,.sg select{background:var(--bg4);border:1px solid var(--bdr);color:#e2e8f0;border-radius:6px;padding:5px 9px;font-size:12px;font-family:'Noto Sans KR',sans-serif;outline:none}
.sg input{width:190px}.sg select{width:140px;cursor:pointer}.sg input:focus{border-color:var(--or)}
.pntoggle{background:var(--bg4);border:1px solid var(--bdr);color:var(--m2);border-radius:6px;padding:5px 11px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:.15s}
.pntoggle.on{background:rgba(249,115,22,.18);border-color:var(--or);color:var(--or)}
.csw{width:22px;height:22px;border-radius:3px;cursor:pointer;border:2px solid transparent;flex-shrink:0}
.csw:hover{border-color:#f97316;transform:scale(1.1)}
/* â”€ Preview â”€ */
.preview{flex:1;overflow:auto;display:flex;justify-content:center;align-items:flex-start;padding:36px 36px 80px}
.scalewrap{transform-origin:top center;flex-shrink:0}
/* â”€ Sheet â”€ */
.sheet{width:794px;height:1123px;background:#fff;color:#111;box-shadow:0 8px 40px rgba(0,0,0,.6);font-family:'Malgun Gothic',sans-serif;padding:56.7px;position:relative;display:flex;flex-direction:column}
.shdr{margin-bottom:7px;flex-shrink:0}
.shdr-top{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:4px}
.stitle{font-size:19px;font-weight:700;cursor:text;min-width:60px;font-family:'Malgun Gothic',sans-serif}
.stitle:focus{outline:2px solid #f97316;background:#fffbf0}
.smeta{display:flex;align-items:center;min-width:200px}
.smeta-lbl{font-size:11px;font-weight:700;padding-right:7px;white-space:nowrap;cursor:pointer}
.smeta-inp{font-size:12px;border:none;outline:none;background:transparent;font-family:'Malgun Gothic',sans-serif;flex:1;min-width:0;width:0}
.smeta-inp:focus{background:#fffbf0}
.smeta-txt{font-size:12px;font-family:'Malgun Gothic',sans-serif;flex:1}
.sdeco{width:100%;height:auto;display:block;margin-bottom:4px}
/* â”€ Grid â”€ */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:5px;flex:1;align-content:stretch;grid-auto-rows:1fr;min-height:0}
.slot{border:1.5px solid #222;display:flex;flex-direction:column;height:100%;min-height:0}
/* photo */
.photo{flex:1;min-height:0;background:#f0f0f0;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:center;position:relative;cursor:pointer;overflow:hidden;transition:background .15s}
.photo:hover{background:#e8e8e8}
.photo img{width:100%;height:100%;object-fit:cover;display:block}
.uphint{display:flex;flex-direction:column;align-items:center;gap:5px;color:#aaa;font-size:11px;pointer-events:none}
.uphint svg{opacity:.35}
.photo input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer}
.delp{position:absolute;top:4px;right:4px;background:rgba(0,0,0,.5);color:#fff;border:none;border-radius:50%;width:20px;height:20px;font-size:12px;cursor:pointer;display:none;align-items:center;justify-content:center;line-height:1}
.photo:hover .delp{display:flex}
.slotnum{position:absolute;top:5px;left:6px;font-size:17px;font-weight:700;color:rgba(0,0,0,.15);pointer-events:none;font-family:'Malgun Gothic',sans-serif;user-select:none}
/* meta row */
.metarow{display:grid;border-bottom:1px solid #222;min-height:22px}
.mlbl{font-size:10px;font-weight:700;padding:3px 5px;border-right:1px solid #222;background:#f5f5f5;display:flex;align-items:center;justify-content:center;overflow:hidden;white-space:nowrap;color:#444;flex-shrink:0;cursor:pointer;box-sizing:border-box}
.mlbl-sep{border-left:1px solid #222}
.minp{font-size:11px;padding:3px 5px;border:none;outline:none;font-family:'Malgun Gothic',sans-serif;background:transparent;color:#111;width:100%;min-width:0}
/* desc row */
.descrow{display:flex;min-height:28px}
.dlbl{font-size:10px;font-weight:700;padding:3px 5px;border-right:1px solid #222;background:#f5f5f5;display:flex;align-items:center;justify-content:center;overflow:hidden;white-space:nowrap;color:#444;flex-shrink:0;cursor:pointer;box-sizing:border-box}
.dinp{flex:1;font-size:11px;padding:3px 5px;border:none;outline:none;font-family:'Malgun Gothic',sans-serif;resize:none;background:transparent;color:#111;line-height:1.5;min-height:26px;width:100%;min-width:0}
/* selection */
.sel{cursor:pointer}.sel.on{background:#fff3e0!important;outline:2px solid #f97316;outline-offset:-1px}
.photo.on{outline:3px solid #f97316;outline-offset:-3px}
/* page wrap */
.pagewrap{position:relative}
.pgnum{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);font-size:10px;color:#888;pointer-events:none;white-space:nowrap;font-family:'Malgun Gothic',sans-serif}
.delpg{position:absolute;top:-11px;right:-11px;width:24px;height:24px;border-radius:50%;background:#ef4444;border:none;color:#fff;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;transition:.15s;line-height:1}
.delpg:hover{background:#b91c1c;transform:scale(1.1)}
.addpgwrap{display:flex;justify-content:center;padding:18px 0 38px}
.addpgbtn{background:var(--bg3);border:2px dashed var(--bdr);border-radius:10px;color:var(--m2);font-size:14px;padding:11px 40px;cursor:pointer;transition:.2s;font-family:'Noto Sans KR',sans-serif}
.addpgbtn:hover{border-color:var(--or);color:var(--or);background:rgba(249,115,22,.07)}
/* zoom */
.zoompanel{position:fixed;bottom:18px;right:18px;z-index:300;background:rgba(23,27,36,.96);backdrop-filter:blur(12px);border:1px solid var(--bdr);border-radius:10px;padding:7px 11px;display:flex;align-items:center;gap:7px}
.zb{background:var(--bg4);border:1px solid var(--bdr);color:var(--m2);border-radius:6px;padding:3px 10px;cursor:pointer;font-size:13px;transition:.1s}.zb:hover{background:var(--bg3);color:#fff}
#zdisp{font-size:13px;color:#fff;min-width:38px;text-align:center}
/* toast */
.toast{position:fixed;bottom:74px;left:50%;transform:translateX(-50%) translateY(18px);background:#1e293b;color:#e2e8f0;padding:7px 17px;border-radius:20px;font-size:13px;opacity:0;transition:.28s;pointer-events:none;z-index:9999;border:1px solid var(--bdr)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
@media print{
  body{overflow:visible!important;height:auto}
  .nav,.toolbar,.fmtbar,.settings,.zoompanel,.toast,.delpg,.addpgwrap{display:none!important}
  .preview{padding:0!important;overflow:visible!important;display:block!important}
  .scalewrap{transform:none!important}
  .sheet{box-shadow:none;width:210mm;height:297mm;padding:15mm}
  .pagewrap{break-after:page}
  @page{size:A4 portrait;margin:0}
}
</style>
</head>
<body>

<nav class="nav">
  <div class="logo">
    <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    SAFETY
  </div>
  <a href="index.html">â† í™ˆ</a>
</nav>

<div class="toolbar">
  <div class="tl">ì‚¬ì§„ëŒ€ì§€ ì‘ì„±</div>
  <button class="btn g" onclick="resetForm()">â†º ì´ˆê¸°í™”</button>
  <button class="btn g" id="undoBtn" onclick="undo()" disabled>â†© ë˜ëŒë¦¬ê¸°</button>
  <button class="btn g" id="addSlotBtn" onclick="addSlot()">+ ì¹¸ ì¶”ê°€ (í˜„ì¬ 6ì¹¸)</button>
  <button class="btn g" id="rmSlotBtn" onclick="removeSlot()" style="display:none">âˆ’ ì¹¸ ì œê±°</button>
  <button class="btn green" onclick="saveExcel()">ğŸ“Š ì—‘ì…€ ì €ì¥</button>
  <button class="btn orange" onclick="printPDF()">ğŸ–¨ PDF ì €ì¥</button>
</div>

<div class="fmtbar">
  <span class="flbl">ê¸€ê¼´</span>
  <select class="fsel" id="fmtFont" onchange="applyFmt('font',this.value)" style="width:108px">
    <option value="'Malgun Gothic',sans-serif" selected>ë§‘ì€ ê³ ë”•</option>
    <option value="'Noto Sans KR',sans-serif">Noto Sans</option>
    <option value="Arial,sans-serif">Arial</option>
    <option value="'Times New Roman',serif">Times</option>
  </select>
  <button class="fb" id="colorBtn" onclick="togglePalette(event)" title="ê¸€ê¼´ ìƒ‰ìƒ" style="padding:0 6px;flex-direction:column;gap:1px;height:26px">
    <span style="font-size:14px;font-weight:700;font-family:'Malgun Gothic',sans-serif;line-height:1.3;color:currentColor">ê°€</span>
    <span id="colorBar" style="display:block;width:18px;height:4px;background:#e84040;border-radius:1px"></span>
  </button>
  <div id="colorPalette" style="display:none;position:fixed;z-index:9000;background:#1e2330;border:1px solid #2e3448;border-radius:8px;padding:10px;box-shadow:0 8px 32px rgba(0,0,0,.7)">
    <div style="font-size:10px;color:#94a3b8;margin-bottom:6px">ìë™</div>
    <div style="display:flex;gap:4px;margin-bottom:8px">
      <div class="csw auto-color" style="width:22px;height:22px;background:#111;border:2px solid #f97316;border-radius:3px;cursor:pointer" onclick="pickColor('#111111')" title="ìë™"></div>
    </div>
    <div style="font-size:10px;color:#94a3b8;margin-bottom:5px">í…Œë§ˆ ìƒ‰</div>
    <div id="themeColors" style="display:grid;grid-template-columns:repeat(10,22px);gap:3px;margin-bottom:8px"></div>
    <div style="font-size:10px;color:#94a3b8;margin-bottom:5px">í‘œì¤€ ìƒ‰</div>
    <div id="stdColors" style="display:grid;grid-template-columns:repeat(10,22px);gap:3px;margin-bottom:8px"></div>
    <div style="font-size:10px;color:#94a3b8;margin-bottom:5px">ìµœê·¼ ìƒ‰</div>
    <div id="recentColors" style="display:grid;grid-template-columns:repeat(10,22px);gap:3px"></div>
  </div>
  <span class="flbl">í¬ê¸°</span>
  <button class="fb" style="min-width:20px;font-size:14px;font-weight:700" onclick="qFont(-1)">âˆ’</button>
  <input class="fnum" type="number" id="fmtSize" value="11" min="6" max="72" onchange="applyFmt('fontSize',this.value+'px')">
  <button class="fb" style="min-width:20px;font-size:14px;font-weight:700" onclick="qFont(1)">+</button>
  <div class="fsep"></div>
  <span class="flbl">ê°€ë¡œ</span>
  <button class="fb" id="AL" onclick="applyFmt('align','left')" title="ì™¼ìª½">
    <svg width="13" height="13" viewBox="0 0 13 13" fill="currentColor"><rect x="0" y="0" width="13" height="2" rx=".8"/><rect x="0" y="3.5" width="8" height="2" rx=".8"/><rect x="0" y="7" width="10" height="2" rx=".8"/><rect x="0" y="10.5" width="6" height="2" rx=".8"/></svg>
  </button>
  <button class="fb" id="AC" onclick="applyFmt('align','center')" title="ê°€ìš´ë°">
    <svg width="13" height="13" viewBox="0 0 13 13" fill="currentColor"><rect x="0" y="0" width="13" height="2" rx=".8"/><rect x="2.5" y="3.5" width="8" height="2" rx=".8"/><rect x="1.5" y="7" width="10" height="2" rx=".8"/><rect x="3.5" y="10.5" width="6" height="2" rx=".8"/></svg>
  </button>
  <button class="fb" id="AR" onclick="applyFmt('align','right')" title="ì˜¤ë¥¸ìª½">
    <svg width="13" height="13" viewBox="0 0 13 13" fill="currentColor"><rect x="0" y="0" width="13" height="2" rx=".8"/><rect x="5" y="3.5" width="8" height="2" rx=".8"/><rect x="3" y="7" width="10" height="2" rx=".8"/><rect x="7" y="10.5" width="6" height="2" rx=".8"/></svg>
  </button>
  <div style="width:1px;height:13px;background:#3e4559;margin:0 3px;flex-shrink:0"></div>
  <button class="fb" id="VT" onclick="applyFmt('valign','top')" title="ìœ„">
    <svg width="13" height="13" viewBox="0 0 13 13"><rect x="0" y="0" width="13" height="1.5" fill="currentColor" rx=".5"/><rect x="1" y="3" width="4" height="8" rx=".8" fill="currentColor" opacity=".5"/><rect x="8" y="3" width="4" height="5" rx=".8" fill="currentColor" opacity=".5"/></svg>
  </button>
  <button class="fb" id="VM" onclick="applyFmt('valign','middle')" title="ê°€ìš´ë°">
    <svg width="13" height="13" viewBox="0 0 13 13"><rect x="0" y="5.75" width="13" height="1.5" fill="currentColor" rx=".5"/><rect x="1" y="1" width="4" height="11" rx=".8" fill="currentColor" opacity=".5"/><rect x="8" y="3" width="4" height="7" rx=".8" fill="currentColor" opacity=".5"/></svg>
  </button>
  <button class="fb" id="VB" onclick="applyFmt('valign','bottom')" title="ì•„ë˜">
    <svg width="13" height="13" viewBox="0 0 13 13"><rect x="0" y="11.5" width="13" height="1.5" fill="currentColor" rx=".5"/><rect x="1" y="2" width="4" height="8" rx=".8" fill="currentColor" opacity=".5"/><rect x="8" y="5" width="4" height="5" rx=".8" fill="currentColor" opacity=".5"/></svg>
  </button>
  <div class="fsep"></div>
  <button class="fb" id="BOLD" onclick="applyFmt('bold',null)" style="font-weight:800;font-size:13px;padding:0 8px">B</button>
  <div class="fsep"></div>
  <span class="flbl">í…Œë‘ë¦¬</span>
  <button class="fb" id="BT" onclick="togBdr('bt')" title="ìœ„">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width=".6" stroke-dasharray="1.5 1"/><line x1="1" y1="1" x2="13" y2="1" stroke="currentColor" stroke-width="2.5"/></svg>
  </button>
  <button class="fb" id="BB" onclick="togBdr('bb')" title="ì•„ë˜">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width=".6" stroke-dasharray="1.5 1"/><line x1="1" y1="13" x2="13" y2="13" stroke="currentColor" stroke-width="2.5"/></svg>
  </button>
  <button class="fb" id="BL" onclick="togBdr('bl')" title="ì™¼">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width=".6" stroke-dasharray="1.5 1"/><line x1="1" y1="1" x2="1" y2="13" stroke="currentColor" stroke-width="2.5"/></svg>
  </button>
  <button class="fb" id="BR" onclick="togBdr('br')" title="ì˜¤ë¥¸">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width=".6" stroke-dasharray="1.5 1"/><line x1="13" y1="1" x2="13" y2="13" stroke="currentColor" stroke-width="2.5"/></svg>
  </button>
  <button class="fb" id="BALL" onclick="togBdr('all')" title="ì „ì²´">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width="2.5"/></svg>
  </button>
  <button class="fb" id="BNONE" onclick="togBdr('none')" title="ì—†ìŒ">
    <svg width="14" height="14" viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="none" stroke="currentColor" stroke-width=".6" stroke-dasharray="1.5 1"/><line x1="3" y1="3" x2="11" y2="11" stroke="#ef4444" stroke-width="1.8"/><line x1="11" y1="3" x2="3" y2="11" stroke="#ef4444" stroke-width="1.8"/></svg>
  </button>
  <div class="fsep"></div>
  <button class="fb" onclick="mergeSelected()">âŠ ë³‘í•©</button>
  <button class="fb" onclick="splitSelected()">âŠŸ ë¶„í• </button>
  <div class="fsep"></div>
  <span class="flbl">ì„¸ë¡œ</span>
  <button class="fb" style="min-width:20px" onclick="adjSz('h',-5)">âˆ’</button>
  <span id="sizeH" style="font-size:10px;color:var(--m2);min-width:32px;text-align:center">â€”</span>
  <button class="fb" style="min-width:20px" onclick="adjSz('h',5)">+</button>
  <div class="fsep"></div>
  <span class="flbl">ê°€ë¡œ</span>
  <button class="fb" style="min-width:20px" onclick="adjSz('w',-2)">âˆ’</button>
  <span id="sizeW" style="font-size:10px;color:var(--m2);min-width:32px;text-align:center">â€”</span>
  <button class="fb" style="min-width:20px" onclick="adjSz('w',2)">+</button>
  <div class="fsep"></div>
  <span id="fhint" class="fhint">ì…€ì„ í´ë¦­í•˜ì—¬ ì„ íƒ</span>
</div>

<div class="settings">
  <div class="sg"><label>í˜„ì¥ëª…</label>
    <input type="text" id="siteName" placeholder="í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="syncSite(this.value)">
  </div>
  <div class="sg"><label>ë¬¸ì„œ ì œëª©</label>
    <input type="text" id="docTitle" value="ì‚¬ì§„ëŒ€ì§€" oninput="syncTitle(this.value)">
  </div>
  <div class="sg"><label>ì¹¸ ìˆ˜</label>
    <select onchange="setSlotCount(+this.value)">
      <option value="2">2ì¹¸ (1Ã—2)</option>
      <option value="4">4ì¹¸ (2Ã—2)</option>
      <option value="6" selected>6ì¹¸ (3Ã—2)</option>
      <option value="8">8ì¹¸ (4Ã—2)</option>
    </select>
  </div>
  <div class="sg"><label>ìª½ í‘œì‹œ</label>
    <button class="pntoggle on" id="pntoggle" onclick="togglePN()">í‘œì‹œ ì¼œì§</button>
  </div>
</div>

<div class="preview" id="preview">
  <div class="scalewrap" id="scalewrap">
    <div id="pgwrap"></div>
  </div>
</div>

<div class="zoompanel">
  <button class="zb" onclick="zOut()">âˆ’</button>
  <span id="zdisp">90%</span>
  <button class="zb" onclick="zIn()">+</button>
  <button class="zb" onclick="zFit()">ë§ì¶¤</button>
</div>
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìƒíƒœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let slotCount = 6;
let showPN = true;
const pages = [];
const sel = new Set();   // "pi:si:ct" í˜•ì‹
const hist = [];         // undo stack
let zoom = 0.9;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê¸°ë³¸ ë°ì´í„° ìƒì„±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function defCell() {
  return {font:"'Malgun Gothic',sans-serif",sz:'11px',align:'left',bold:false,va:'middle',bt:0,bb:0,bl:0,br:0,color:'#111'};
}
function defLbl() {
  return {font:"'Malgun Gothic',sans-serif",sz:'10px',align:'center',bold:true,va:'middle',bt:0,bb:0,bl:0,br:0,color:'#444'};
}
function newSlot() {
  return {
    img:'',loc:'',date:'',desc:'',
    locLbl:'ìœ„ì¹˜',dateLbl:'ì¼ì‹œ',descLbl:'ë‚´ìš©',
    merged:false,
    ph:220,mh:22,dh:28,
    lw:38,dw:38,ew:38,
    cells:{
      photo:defCell(),
      loc:defCell(),date:defCell(),desc:defCell(),
      locLabel:defLbl(),dateLabel:defLbl(),descLabel:defLbl()
    }
  };
}
function ensureSlots(pg) {
  while (pg.slots.length < slotCount) pg.slots.push(newSlot());
  if (!pg.titleFmt) pg.titleFmt = {font:"'Malgun Gothic',sans-serif",sz:'19px',bold:true,color:'#111'};
  if (!pg.siteFmt)  pg.siteFmt  = {font:"'Malgun Gothic',sans-serif",sz:'12px',bold:false,color:'#111'};
  if (!pg.siteLblFmt) pg.siteLblFmt = {font:"'Malgun Gothic',sans-serif",sz:'11px',bold:true,color:'#111'};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Undo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveUndo() {
  hist.push(JSON.stringify({
    slotCount,
    pgs: pages.map(p=>({slots:p.slots})),
    title: document.getElementById('docTitle').value,
    site: document.getElementById('siteName').value
  }));
  if (hist.length > 50) hist.shift();
  document.getElementById('undoBtn').disabled = false;
}
function applyColor(value) {
  document.getElementById('colorBar').style.background = value;
  applyFmt('color', value);
}
function undo() {
  if (!hist.length) { toast('ë˜ëŒë¦´ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤'); return; }
  const s = JSON.parse(hist.pop());
  slotCount = s.slotCount;
  pages.length = 0;
  s.pgs.forEach(p => pages.push({slots:p.slots}));
  document.getElementById('docTitle').value = s.title;
  document.getElementById('siteName').value = s.site;
  sel.clear();
  renderAll();
  if (!hist.length) document.getElementById('undoBtn').disabled = true;
  toast('â†© ë˜ëŒë¦¬ê¸°');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë™ê¸°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function syncTitle(v) { document.querySelectorAll('.sync-title').forEach(e=>e.textContent=v); }
function syncSite(v)  { document.querySelectorAll('.sync-site').forEach(e=>{if(e.tagName==='INPUT')e.value=v;else e.textContent=v;}); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì…€ ì„ íƒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selCell(pi, si, ct, multi) {
  const k = `${pi}:${si}:${ct}`;
  if (!multi) sel.clear();
  if (sel.has(k)) sel.delete(k);
  else sel.add(k);
  refreshSel();
  refreshFmtBar();
}
function selHdr(pi, type) {
  sel.clear();
  sel.add(`${pi}:hdr:${type}`);
  refreshSel();
  refreshFmtBar();
}
let recentColors = [];
let paletteOpen = false;
function togglePalette(e) {
  e.stopPropagation();
  const pal = document.getElementById('colorPalette');
  if (paletteOpen) { pal.style.display='none'; paletteOpen=false; return; }
  // ìœ„ì¹˜ ê³„ì‚°
  const btn = document.getElementById('colorBtn');
  const r = btn.getBoundingClientRect();
  pal.style.top = (r.bottom+4)+'px';
  pal.style.left = r.left+'px';
  buildPalette();
  pal.style.display='block';
  paletteOpen=true;
}
function buildPalette() {
  const theme = [
    ['#ffffff','#000000','#e7e6e6','#44546a','#4472c4','#ed7d31','#a9d18e','#ff0000','#ffff00','#92d050'],
    ['#f2f2f2','#7f7f7f','#d0cece','#d6dce4','#dae3f3','#fce4d6','#e2efda','#ffc7ce','#ffeb9c','#c6efce'],
    ['#d8d8d8','#595959','#aeabab','#adb9ca','#b4c6e7','#f8cbad','#c6e0b4','#ff8080','#ffd966','#70ad47'],
    ['#bfbfbf','#404040','#767171','#8497b0','#8faadc','#f4b183','#a9d18e','#ff0000','#ffbf00','#548235'],
    ['#a5a5a5','#262626','#3a3838','#323f4f','#2e75b6','#c55a11','#538135','#c00000','#bf8f00','#375623'],
  ];
  const std = ['#c00000','#ff0000','#ffc000','#ffff00','#92d050','#00b050','#00b0f0','#0070c0','#002060','#7030a0'];

  const tc = document.getElementById('themeColors'); tc.innerHTML='';
  const sc = document.getElementById('stdColors'); sc.innerHTML='';
  const rc = document.getElementById('recentColors'); rc.innerHTML='';

  theme.forEach(row=>row.forEach(col=>{
    const d=document.createElement('div'); d.className='csw';
    d.style.background=col; d.title=col;
    d.onclick=()=>pickColor(col);
    tc.appendChild(d);
  }));
  std.forEach(col=>{
    const d=document.createElement('div'); d.className='csw';
    d.style.background=col; d.title=col;
    d.onclick=()=>pickColor(col);
    sc.appendChild(d);
  });
  recentColors.slice(0,10).forEach(col=>{
    const d=document.createElement('div'); d.className='csw';
    d.style.background=col; d.title=col;
    d.onclick=()=>pickColor(col);
    rc.appendChild(d);
  });
}
function pickColor(val) {
  document.getElementById('colorPalette').style.display='none'; paletteOpen=false;
  document.getElementById('colorBar').style.background=val;
  if (!recentColors.includes(val)) { recentColors.unshift(val); if(recentColors.length>10) recentColors.pop(); }
  applyFmt('color',val);
}
document.addEventListener('click',()=>{ if(paletteOpen){document.getElementById('colorPalette').style.display='none';paletteOpen=false;} });
function refreshSel() {
  document.querySelectorAll('.sel').forEach(el => {
    const slot = el.closest('[data-idx]');
    if (!slot) return;
    const active = sel.has(`${slot.dataset.page}:${slot.dataset.idx}:${el.dataset.ct}`);
    el.classList.toggle('on', active);
  });
  // hdr ìš”ì†Œ í•˜ì´ë¼ì´íŠ¸
  document.querySelectorAll('[data-hdr-page]').forEach(el => {
    const active = sel.has(`${el.dataset.hdrPage}:hdr:${el.dataset.hdrType}`);
    el.style.outline = active ? '2px solid #f97316' : '';
    el.style.outlineOffset = active ? '-1px' : '';
    if (el.tagName==='INPUT'||el.tagName==='DIV') el.style.background = active ? '#fff3e0' : '';
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í¬ë§·ë°” ê°±ì‹  â€” ë‹¨ í•˜ë‚˜ì˜ í•¨ìˆ˜ê°€ ëª¨ë“  ë²„íŠ¼ ì²˜ë¦¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BTN_IDS = ['AL','AC','AR','VT','VM','VB','BOLD','BT','BB','BL','BR','BALL','BNONE'];
function refreshFmtBar() {
  // 1) í•­ìƒ ì „ë¶€ ì´ˆê¸°í™”
  BTN_IDS.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('on');
  });
  document.getElementById('fhint').textContent = 'ì…€ì„ í´ë¦­í•˜ì—¬ ì„ íƒ';
  document.getElementById('sizeH').textContent = 'â€”';
  document.getElementById('sizeW').textContent = 'â€”';

  if (!sel.size) return;

  // 2) ì²« ë²ˆì§¸ ì„ íƒ ì…€ì˜ ë°ì´í„°ë¡œ ë²„íŠ¼ ìƒíƒœ ì„¤ì •
  const [pi,si,ct] = [...sel][0].split(':');

  // í—¤ë”(ì œëª©/í˜„ì¥ëª…) íŠ¹ìˆ˜ ì²˜ë¦¬
  if (si === 'hdr') {
    const pg = pages[+pi]; if (!pg) return;
    const f = ct==='title' ? pg.titleFmt : ct==='sitelabel' ? pg.siteLblFmt : pg.siteFmt;
    if (!f) return;
    document.getElementById('fmtFont').value = f.font||"'Malgun Gothic',sans-serif";
    document.getElementById('fmtSize').value = parseInt(f.sz)||11;
    document.getElementById('colorBar').style.background = f.color||'#111111';
    const hintMap={title:'ë¬¸ì„œ ì œëª© ì„ íƒë¨',site:'í˜„ì¥ëª… ì„ íƒë¨',sitelabel:'í˜„ì¥ëª… ë¼ë²¨ ì„ íƒë¨'};
    document.getElementById('fhint').textContent = hintMap[ct]||'';
    if (f.bold) document.getElementById('BOLD').classList.add('on');
    return;
  }

  const d = pages[+pi]?.slots[+si];
  const f = d?.cells[ct];
  if (!f) return;

  // í°íŠ¸/í¬ê¸°
  document.getElementById('fmtFont').value = f.font;
  document.getElementById('fmtSize').value = parseInt(f.sz) || 11;

  // ê°€ë¡œ ì •ë ¬
  const aMap = {left:'AL', center:'AC', right:'AR'};
  if (aMap[f.align]) document.getElementById(aMap[f.align]).classList.add('on');

  // ì„¸ë¡œ ì •ë ¬
  const vMap = {top:'VT', middle:'VM', bottom:'VB'};
  if (vMap[f.va]) document.getElementById(vMap[f.va]).classList.add('on');

  // ìƒ‰ìƒ
  const col = f.color || '#111111';
  document.getElementById('colorBar').style.background = col;

  // ë³¼ë“œ
  if (f.bold) document.getElementById('BOLD').classList.add('on');

  // í…Œë‘ë¦¬
  if (f.bt) document.getElementById('BT').classList.add('on');
  if (f.bb) document.getElementById('BB').classList.add('on');
  if (f.bl) document.getElementById('BL').classList.add('on');
  if (f.br) document.getElementById('BR').classList.add('on');
  if (f.bt && f.bb && f.bl && f.br) document.getElementById('BALL').classList.add('on');
  if (!f.bt && !f.bb && !f.bl && !f.br) document.getElementById('BNONE').classList.add('on');

  // íŒíŠ¸ & í¬ê¸°
  const lbl = {loc:'ìœ„ì¹˜',date:'ì¼ì‹œ',desc:'ë‚´ìš©',photo:'ì‚¬ì§„',locLabel:'ìœ„ì¹˜ë¼ë²¨',dateLabel:'ì¼ì‹œë¼ë²¨',descLabel:'ë‚´ìš©ë¼ë²¨'};
  document.getElementById('fhint').textContent =
    [...sel].map(k=>{const p=k.split(':');return `${+p[0]+1}p-${+p[1]+1}ë²ˆ ${lbl[p[2]]||p[2]}`;}).join(', ') + ' ì„ íƒë¨';

  if (ct==='photo') document.getElementById('sizeH').textContent = (d.ph||220)+'px';
  else if (['loc','locLabel','date','dateLabel'].includes(ct)) document.getElementById('sizeH').textContent = (d.mh||22)+'px';
  else if (['desc','descLabel'].includes(ct)) document.getElementById('sizeH').textContent = (d.dh||28)+'px';

  if (['loc','locLabel'].includes(ct)) document.getElementById('sizeW').textContent = (d.lw||38)+'px';
  else if (['date','dateLabel'].includes(ct)) document.getElementById('sizeW').textContent = (d.dw||38)+'px';
  else if (['desc','descLabel'].includes(ct)) document.getElementById('sizeW').textContent = (d.ew||38)+'px';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í¬ë§· ì ìš©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyFmt(type, value) {
  if (!sel.size) return;
  saveUndo();
  sel.forEach(k => {
    const [pi,si,ct] = k.split(':');
    if (si === 'hdr') {
      const pg = pages[+pi]; if (!pg) return;
      const f = ct==='title' ? pg.titleFmt : ct==='sitelabel' ? pg.siteLblFmt : pg.siteFmt;
      if (!f) return;
      if (type==='font')    { f.font=value; }
      if (type==='fontSize') { f.sz=value; }
      if (type==='bold')    { f.bold=!f.bold; }
      if (type==='color')   { f.color=value; }
      // DOM ì¦‰ì‹œ ë°˜ì˜
      const el = document.querySelector(`[data-hdr-page="${pi}"][data-hdr-type="${ct}"]`);
      if (el) {
        el.style.fontFamily=f.font;
        el.style.fontSize=f.sz;
        el.style.fontWeight=f.bold?'700':'400';
        el.style.color=f.color;
      }
      return;
    }
    const f = pages[+pi]?.slots[+si]?.cells[ct];
    if (!f) return;
    if (type==='font')    f.font = value;
    if (type==='fontSize') f.sz = value;
    if (type==='align')   f.align = value;
    if (type==='valign')  f.va = value;
    if (type==='bold')    f.bold = !f.bold;
    applyFmtDOM(pi, si, ct, f);
  });
  refreshFmtBar();
}
function applyFmtDOM(pi, si, ct, f) {
  const slot = document.querySelector(`[data-page="${pi}"][data-idx="${si}"]`);
  if (!slot) return;
  const el = slot.querySelector(`[data-ct="${ct}"]`);
  if (!el) return;
  const jc = {left:'flex-start',center:'center',right:'flex-end'};
  const ai = {top:'flex-start',middle:'center',bottom:'flex-end'};
  const isLbl = ct.endsWith('Label');
  if (isLbl) {
    el.style.fontFamily = f.font;
    el.style.fontSize = f.sz;
    el.style.fontWeight = f.bold ? '700' : '400';
    el.style.color = f.color || '';
    el.style.justifyContent = jc[f.align] || 'center';
    el.style.alignItems = ai[f.va] || 'center';
    const inp = el.querySelector('input');
    if (inp) { inp.style.textAlign = f.align || 'center'; inp.style.color = f.color || ''; }
  } else {
    el.style.fontFamily = f.font;
    el.style.fontSize = f.sz;
    el.style.fontWeight = f.bold ? '700' : '400';
    el.style.textAlign = f.align;
    el.style.color = f.color || '';
  }
  applyBdrDOM(el, f);
}
function applyBdrDOM(el, f) {
  const b = '1.5px solid #333';
  el.style.borderTop    = f.bt ? b : '';
  el.style.borderBottom = f.bb ? b : '';
  el.style.borderLeft   = f.bl ? b : '';
  el.style.borderRight  = f.br ? b : '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í°íŠ¸ í¬ê¸° ë²„íŠ¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function qFont(d) {
  if (!sel.size) return;
  const [pi,si,ct] = [...sel][0].split(':');
  let f;
  if (si === 'hdr') {
    const pg = pages[+pi];
    f = ct==='title' ? pg?.titleFmt : ct==='sitelabel' ? pg?.siteLblFmt : pg?.siteFmt;
  } else {
    f = pages[+pi]?.slots[+si]?.cells[ct];
  }
  if (!f) return;
  const n = Math.max(6, Math.min(72, (parseInt(f.sz)||11) + d));
  applyFmt('fontSize', n+'px');
  document.getElementById('fmtSize').value = n;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í…Œë‘ë¦¬ í† ê¸€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togBdr(side) {
  if (!sel.size) { toast('ì…€ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”'); return; }
  saveUndo();
  sel.forEach(k => {
    const [pi,si,ct] = k.split(':');
    const f = pages[+pi]?.slots[+si]?.cells[ct];
    if (!f) return;
    if (side==='all')  { f.bt=f.bb=f.bl=f.br=1; }
    else if (side==='none') { f.bt=f.bb=f.bl=f.br=0; }
    else { f[side] = f[side] ? 0 : 1; }
    const slot = document.querySelector(`[data-page="${pi}"][data-idx="${si}"]`);
    const el = slot?.querySelector(`[data-ct="${ct}"]`);
    if (el) applyBdrDOM(el, f);
  });
  refreshFmtBar();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í¬ê¸° ì¡°ì ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function adjSz(axis, delta) {
  if (axis === 'h') {
    (sel.size ? [...sel] : Array.from({length:slotCount},(_,i)=>`0:${i}:photo`)).forEach(k=>{
      const [pi,si,ct] = k.split(':');
      const d = pages[+pi]?.slots[+si]; if (!d) return;
      const slot = document.querySelector(`[data-page="${pi}"][data-idx="${si}"]`);
      if (ct==='photo'||(!sel.size)) {
        d.ph = Math.max(30, Math.min(600, (d.ph||220)+delta));
        const pa = slot?.querySelector('.photo'); if(pa){pa.style.flex='none';pa.style.height=d.ph+'px';}
      } else if (['loc','locLabel','date','dateLabel'].includes(ct)) {
        d.mh = Math.max(8, Math.min(80, (d.mh||22)+delta));
        const r = slot?.querySelector('.metarow');
        if(r){ r.style.minHeight=d.mh+'px'; r.style.height=d.mh+'px'; r.style.overflow='hidden'; }
      } else if (['desc','descLabel'].includes(ct)) {
        d.dh = Math.max(8, Math.min(200, (d.dh||28)+delta));
        const r = slot?.querySelector('.descrow');
        if(r){ r.style.minHeight=d.dh+'px'; r.style.height=d.dh+'px'; r.style.overflow='hidden'; }
        const ta = slot?.querySelector('.dinp');
        if(ta){ ta.style.minHeight=(d.dh-2)+'px'; ta.style.height=(d.dh-2)+'px'; }
      }
    });
  } else {
    (sel.size ? [...sel] : Array.from({length:slotCount},(_,i)=>`0:${i}:loc`)).forEach(k=>{
      const [pi,si,ct] = k.split(':');
      const d = pages[+pi]?.slots[+si]; if (!d) return;
      if (['loc','locLabel'].includes(ct)||!sel.size) {
        d.lw = Math.max(10, Math.min(120, (d.lw||38)+delta));
        if (!sel.size) d.dw = d.ew = d.lw;
        applyLW(+pi,+si);
      } else if (['date','dateLabel'].includes(ct)) {
        d.dw = Math.max(10, Math.min(120, (d.dw||38)+delta));
        applyLW(+pi,+si);
      } else if (['desc','descLabel'].includes(ct)) {
        d.ew = Math.max(10, Math.min(120, (d.ew||38)+delta));
        applyLW(+pi,+si);
      }
    });
  }
  refreshFmtBar();
}
function applyLW(pi, si) {
  const slot = document.querySelector(`[data-page="${pi}"][data-idx="${si}"]`); if (!slot) return;
  const d = pages[pi]?.slots[si]; if (!d) return;
  const lw=d.lw+'px', dw=d.dw+'px', ew=d.ew+'px';
  slot.style.setProperty('--lw',lw);
  slot.style.setProperty('--dw',dw);
  slot.style.setProperty('--ew',ew);
  const mr = slot.querySelector('.metarow');
  if (mr) mr.style.gridTemplateColumns = d.merged ? `${lw} 1fr` : `${lw} 1fr ${dw} 1fr`;
  const dl = slot.querySelector('.dlbl');
  if (dl) { dl.style.width=ew; dl.style.minWidth=ew; dl.style.maxWidth=ew; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë³‘í•© / ë¶„í• 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mergeSelected() {
  if (!sel.size) { toast('ì…€ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
  saveUndo();
  const done = new Set();
  [...sel].forEach(k=>{
    const [pi,si] = k.split(':'); const key=`${pi}:${si}`;
    if (done.has(key)) return; done.add(key);
    const d = pages[+pi]?.slots[+si]; if (!d||d.merged) return;
    if (d.date) d.loc += (d.loc?' ':'')+d.date;
    d.merged = true;
  });
  renderAll(); toast('ë³‘í•©ë¨');
}
function splitSelected() {
  if (!sel.size) { toast('ì…€ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
  saveUndo();
  const done = new Set();
  [...sel].forEach(k=>{
    const [pi,si] = k.split(':'); const key=`${pi}:${si}`;
    if (done.has(key)) return; done.add(key);
    const d = pages[+pi]?.slots[+si]; if (d) d.merged = false;
  });
  renderAll(); toast('ë¶„í• ë¨');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  cStyle í—¬í¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cStyle(f, isLbl) {
  if (!f) return '';
  const jc = {left:'flex-start',center:'center',right:'flex-end'};
  const ai = {top:'flex-start',middle:'center',bottom:'flex-end'};
  const b = '1.5px solid #333';
  const bdr = `border-top:${f.bt?b:''};border-bottom:${f.bb?b:''};border-left:${f.bl?b:''};border-right:${f.br?b:''}`;
  if (isLbl) return `display:flex;font-family:${f.font};font-size:${f.sz};font-weight:${f.bold?'700':'400'};justify-content:${jc[f.align]||'center'};align-items:${ai[f.va||'middle']||'center'};overflow:hidden;box-sizing:border-box;${bdr}`;
  return `font-family:${f.font};font-size:${f.sz};text-align:${f.align};font-weight:${f.bold?'700':'400'};${bdr}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìŠ¬ë¡¯ DOM ìƒì„±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeSlot(pi, si, d) {
  d = d || newSlot();
  const lw=d.lw+'px', dw=d.dw+'px', ew=d.ew+'px';
  const div = document.createElement('div');
  div.className = 'slot'; div.dataset.idx = si; div.dataset.page = pi;
  div.style.setProperty('--lw',lw); div.style.setProperty('--dw',dw); div.style.setProperty('--ew',ew);

  // ì‚¬ì§„
  const pa = document.createElement('div');
  pa.className = 'photo sel'; pa.dataset.ct = 'photo';
  if (sel.has(`${pi}:${si}:photo`)) pa.classList.add('on');
  if (d.ph !== 220) { pa.style.flex='none'; pa.style.height=d.ph+'px'; }
  pa.addEventListener('click', e => {
    if (e.target.closest('input[type=file],button')) return;
    e.stopPropagation(); selCell(pi, si, 'photo', e.ctrlKey||e.metaKey);
  });
  const numEl = document.createElement('div');
  numEl.className = 'slotnum'; numEl.textContent = si+1;
  pa.appendChild(numEl);
  if (d.img) {
    const img = document.createElement('img'); img.src = d.img;
    const del = document.createElement('button'); del.className='delp'; del.textContent='âœ•';
    del.onclick = e => { e.stopPropagation(); saveUndo(); d.img=''; renderAll(); };
    pa.append(img, del);
  } else {
    const hint = document.createElement('div'); hint.className='uphint';
    hint.innerHTML=`<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><span>ì‚¬ì§„ í´ë¦­ or ë“œë˜ê·¸</span>`;
    const fi = document.createElement('input'); fi.type='file'; fi.accept='image/*';
    fi.onchange = e => {
      const file = e.target.files[0]; if (!file) return;
      const r = new FileReader();
      r.onload = ev => { saveUndo(); d.img=ev.target.result; renderAll(); };
      r.readAsDataURL(file);
    };
    pa.append(hint, fi);
  }
  div.appendChild(pa);

  // ìœ„ì¹˜+ì¼ì‹œ í–‰
  const mr = document.createElement('div');
  mr.className = 'metarow'; mr.style.minHeight = d.mh+'px'; mr.style.height = d.mh+'px'; mr.style.overflow='hidden';
  mr.style.gridTemplateColumns = d.merged ? `${lw} 1fr` : `${lw} 1fr ${dw} 1fr`;

  function mkLbl(ct, txtKey, extraCls) {
    const lbl = document.createElement('div');
    lbl.className = 'mlbl sel' + (extraCls?' '+extraCls:'');
    lbl.dataset.ct = ct;
    if (sel.has(`${pi}:${si}:${ct}`)) lbl.classList.add('on');
    lbl.style.cssText = cStyle(d.cells[ct], true);
    const inp = document.createElement('input'); inp.type='text'; inp.value=d[txtKey]||'';
    inp.style.cssText = `background:none;border:none;outline:none;padding:0;margin:0;font:inherit;color:inherit;text-align:${d.cells[ct]?.align||'center'};width:100%;min-width:0;cursor:text`;
    inp.oninput = ev => { saveUndo(); d[txtKey]=ev.target.value; };
    inp.onfocus = ev => { ev.stopPropagation(); selCell(pi,si,ct,false); };
    lbl.appendChild(inp);
    lbl.addEventListener('click', e=>{ if(e.target===lbl)inp.focus(); e.stopPropagation(); selCell(pi,si,ct,e.ctrlKey||e.metaKey); });
    return lbl;
  }
  function mkInp(ct, val, ph) {
    const inp = document.createElement('input');
    inp.className = 'minp sel'; inp.dataset.ct = ct;
    if (sel.has(`${pi}:${si}:${ct}`)) inp.classList.add('on');
    inp.value=val; inp.placeholder=ph; inp.style.cssText=cStyle(d.cells[ct],false);
    inp.oninput = ev => { saveUndo(); d[ct==='loc'?'loc':'date']=ev.target.value; };
    inp.addEventListener('click', e=>{ e.stopPropagation(); selCell(pi,si,ct,e.ctrlKey||e.metaKey); });
    return inp;
  }
  const lblLoc  = mkLbl('locLabel','locLbl',null);
  const inpLoc  = mkInp('loc', d.loc, 'ì´¬ì˜ ìœ„ì¹˜');
  const lblDate = mkLbl('dateLabel','dateLbl','mlbl-sep');
  const inpDate = mkInp('date', d.date, 'YYYY-MM-DD');
  if (d.merged) { [lblDate,inpDate].forEach(e=>e.style.display='none'); }
  mr.append(lblLoc, inpLoc, lblDate, inpDate);
  div.appendChild(mr);

  // ë‚´ìš© í–‰
  const dr = document.createElement('div');
  dr.className = 'descrow'; dr.style.minHeight = d.dh+'px'; dr.style.height = d.dh+'px'; dr.style.overflow='hidden';
  const dlbl = document.createElement('div');
  dlbl.className = 'dlbl sel'; dlbl.dataset.ct = 'descLabel';
  if (sel.has(`${pi}:${si}:descLabel`)) dlbl.classList.add('on');
  dlbl.style.cssText = cStyle(d.cells.descLabel, true);
  dlbl.style.width=ew; dlbl.style.minWidth=ew; dlbl.style.maxWidth=ew;
  const dinpLbl = document.createElement('input'); dinpLbl.type='text'; dinpLbl.value=d.descLbl||'ë‚´ìš©';
  dinpLbl.style.cssText = `background:none;border:none;outline:none;padding:0;margin:0;font:inherit;color:inherit;text-align:${d.cells.descLabel?.align||'center'};width:100%;min-width:0;cursor:text`;
  dinpLbl.oninput = e=>{ saveUndo(); d.descLbl=e.target.value; };
  dinpLbl.onfocus = e=>{ e.stopPropagation(); selCell(pi,si,'descLabel',false); };
  dlbl.appendChild(dinpLbl);
  dlbl.addEventListener('click', e=>{ if(e.target===dlbl)dinpLbl.focus(); e.stopPropagation(); selCell(pi,si,'descLabel',e.ctrlKey||e.metaKey); });
  const ta = document.createElement('textarea');
  ta.className = 'dinp sel'; ta.dataset.ct = 'desc';
  if (sel.has(`${pi}:${si}:desc`)) ta.classList.add('on');
  ta.rows=2; ta.placeholder='ì‚¬ì§„ ì„¤ëª…'; ta.value=d.desc;
  ta.style.cssText = cStyle(d.cells.desc, false);
  ta.oninput = e=>{ saveUndo(); d.desc=e.target.value; };
  ta.addEventListener('click', e=>{ e.stopPropagation(); selCell(pi,si,'desc',e.ctrlKey||e.metaKey); });
  dr.append(dlbl, ta);
  div.appendChild(dr);
  return div;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì „ì²´ ë Œë”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DECO='data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAKB9ADASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAYHBQj/xAAmEAEAAQIEBgIDAAAAAAAAAAAAAQIDBAUGEQcSEyEiURRBMWGB/8QAGQEBAAMBAQAAAAAAAAAAAAAAAAQFBgcD/8QAIREBAAIBAwQDAAAAAAAAAAAAAAECAwQFESExQnEVQZH/2gAMAwEAAhEDEQA/APOOlMy+dgIt3Kt79rxq/cfUuyhNEzMZzERMxE0Tuu3RNm1N9Rpa2v3jp+MfuWGuHPMV7T1AFoggAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJ7V2cXMFFvD4W5NF+aormqJ70xH4aZozO7ee5HaxcTHWiOW9T6qhhupJmc7xO8zPn9rjgfVV8zH0c08vJTO2/bfdzDf8ANbU572t4zxHpM3nbsXxkZfKvE8+/pqgDNsCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJjiLqCMiyOvo17Yu/4WvdPur+KdjfGeqqdTW6ZqmaYsxtG/aHtgpF7xErjYtJTVa2tMnaOvvh/9k=';

function renderAll() {
  const title = document.getElementById('docTitle').value || 'ì‚¬ì§„ëŒ€ì§€';
  const site  = document.getElementById('siteName').value || '';
  const wrap  = document.getElementById('pgwrap');
  wrap.innerHTML = '';
  wrap.style.cssText = 'display:flex;flex-direction:column;gap:22px;align-items:center';

  pages.forEach((pg, pi) => {
    ensureSlots(pg);
    const pw = document.createElement('div'); pw.className='pagewrap';
    if (pages.length > 1) {
      const db = document.createElement('button'); db.className='delpg';
      db.textContent='Ã—'; db.title=`${pi+1}í˜ì´ì§€ ì‚­ì œ`;
      db.onclick = ()=>delPage(pi); pw.appendChild(db);
    }
    const sheet = document.createElement('div'); sheet.className='sheet';

    // í—¤ë”
    const hdr = document.createElement('div'); hdr.className='shdr';
    const htop = document.createElement('div'); htop.className='shdr-top';
    const tEl = document.createElement('div'); tEl.className='stitle'; tEl.textContent=title;
    tEl.dataset.hdrPage=pi; tEl.dataset.hdrType='title';
    const tf = pg.titleFmt||{}; tEl.style.fontFamily=tf.font||"'Malgun Gothic',sans-serif"; tEl.style.fontSize=tf.sz||'19px'; tEl.style.color=tf.color||'#111'; tEl.style.fontWeight=tf.bold===false?'400':'700';
    tEl.addEventListener('click',e=>{e.stopPropagation();selHdr(pi,'title');});
    if (pi===0) {
      tEl.contentEditable = 'true';
      tEl.oninput = ()=>{ document.getElementById('docTitle').value=tEl.textContent; syncTitle(tEl.textContent); };
    } else {
      tEl.classList.add('sync-title');
    }
    const mDiv = document.createElement('div'); mDiv.className='smeta';
    const mLbl = document.createElement('div'); mLbl.className='smeta-lbl';
    mLbl.textContent='í˜„ì¥ëª… :';
    mLbl.dataset.hdrPage=pi; mLbl.dataset.hdrType='sitelabel';
    mLbl.style.cursor='pointer';
    const slf=pg.siteLblFmt||{}; if(slf.font)mLbl.style.fontFamily=slf.font; if(slf.sz)mLbl.style.fontSize=slf.sz; if(slf.color)mLbl.style.color=slf.color; if(slf.bold===false)mLbl.style.fontWeight='400';
    mLbl.addEventListener('click',e=>{e.stopPropagation();selHdr(pi,'sitelabel');});
    if (pi===0) {
      const sinp = document.createElement('input'); sinp.className='smeta-inp sync-site';
      sinp.placeholder='í˜„ì¥ëª…'; sinp.value=site;
      sinp.dataset.hdrPage=pi; sinp.dataset.hdrType='site';
      const sf=pg.siteFmt||{}; sinp.style.fontFamily=sf.font||"'Malgun Gothic',sans-serif"; sinp.style.fontSize=sf.sz||'12px'; sinp.style.color=sf.color||'#111'; sinp.style.fontWeight=sf.bold?'700':'400';
      sinp.oninput = ()=>{ document.getElementById('siteName').value=sinp.value; syncSite(sinp.value); };
      sinp.addEventListener('click',e=>{e.stopPropagation();selHdr(pi,'site');});
      mDiv.append(mLbl, sinp);
    } else {
      const sv = document.createElement('div'); sv.className='smeta-txt sync-site'; sv.textContent=site;
      sv.dataset.hdrPage=pi; sv.dataset.hdrType='site';
      const sf2=pg.siteFmt||{}; sv.style.fontFamily=sf2.font||"'Malgun Gothic',sans-serif"; sv.style.fontSize=sf2.sz||'12px'; sv.style.color=sf2.color||'#111'; sv.style.fontWeight=sf2.bold?'700':'400';
      sv.addEventListener('click',e=>{e.stopPropagation();selHdr(pi,'site');});
      mDiv.append(mLbl, sv);
    }
    htop.append(tEl, mDiv);
    const deco = document.createElement('img'); deco.className='sdeco'; deco.src=DECO;
    hdr.append(htop, deco); sheet.appendChild(hdr);

    // ê·¸ë¦¬ë“œ
    const grid = document.createElement('div'); grid.className='grid';
    for (let i=0; i<slotCount; i++) grid.appendChild(makeSlot(pi, i, pg.slots[i]));
    if (slotCount%2!==0) {
      const em = document.createElement('div');
      em.style.cssText='border:1.5px dashed #ddd;display:flex;align-items:center;justify-content:center;color:#ccc;font-size:12px';
      em.textContent='ë¹ˆ ì¹¸'; grid.appendChild(em);
    }
    sheet.appendChild(grid);

    const pn = document.createElement('div'); pn.className='pgnum';
    pn.textContent=`${pi+1} / ${pages.length}`;
    if (!showPN) pn.style.display='none';
    sheet.appendChild(pn);
    pw.appendChild(sheet); wrap.appendChild(pw);
  });

  // í˜ì´ì§€ ì¶”ê°€ ë²„íŠ¼
  const apw = document.createElement('div'); apw.className='addpgwrap';
  const apb = document.createElement('button'); apb.className='addpgbtn';
  apb.textContent='ï¼‹ í˜ì´ì§€ ì¶”ê°€'; apb.onclick=addPage;
  apw.appendChild(apb); wrap.appendChild(apw);

  document.getElementById('addSlotBtn').textContent=`+ ì¹¸ ì¶”ê°€ (í˜„ì¬ ${slotCount}ì¹¸)`;
  document.getElementById('rmSlotBtn').style.display = slotCount>2 ? '' : 'none';
  refreshSel();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í˜ì´ì§€ ê´€ë¦¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addPage() {
  saveUndo();
  const pg={slots:[]}; ensureSlots(pg); pages.push(pg);
  renderAll();
  setTimeout(()=>{
    const pws=document.querySelectorAll('.pagewrap');
    if(pws.length) pws[pws.length-1].scrollIntoView({behavior:'smooth',block:'center'});
  },150);
}
function delPage(pi) {
  if (pages.length<=1) { toast('ë§ˆì§€ë§‰ í˜ì´ì§€ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); return; }
  saveUndo(); pages.splice(pi,1); renderAll();
  toast(`${pi+1}í˜ì´ì§€ ì‚­ì œë¨`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì¹¸ ìˆ˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setSlotCount(n) { saveUndo(); slotCount=n; pages.forEach(ensureSlots); renderAll(); }
function addSlot() {
  if (slotCount>=12) { toast('ìµœëŒ€ 12ì¹¸'); return; }
  saveUndo(); slotCount+=2;
  pages.forEach(pg=>{ pg.slots.push(newSlot()); pg.slots.push(newSlot()); });
  renderAll();
}
function removeSlot() { if(slotCount<=2) return; saveUndo(); slotCount-=2; renderAll(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì´ˆê¸°í™” / ì €ì¥
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function resetForm() {
  if (!confirm('ì‘ì„± ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  saveUndo();
  pages.length=0; sel.clear();
  const pg={slots:[]}; ensureSlots(pg); pages.push(pg);
  document.getElementById('siteName').value='';
  document.getElementById('docTitle').value='ì‚¬ì§„ëŒ€ì§€';
  renderAll(); toast('ì´ˆê¸°í™”ë¨');
}
function printPDF() { toast('ì¸ì‡„ ì°½ì—ì„œ "PDFë¡œ ì €ì¥" ì„ íƒ'); setTimeout(()=>window.print(),500); }
function saveExcel() { toast('ì—‘ì…€ ì €ì¥ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìª½ í‘œì‹œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePN() {
  showPN = !showPN;
  const btn = document.getElementById('pntoggle');
  btn.textContent = showPN ? 'í‘œì‹œ ì¼œì§' : 'í‘œì‹œ êº¼ì§';
  btn.classList.toggle('on', showPN);
  document.querySelectorAll('.pgnum').forEach(e=>e.style.display=showPN?'':'none');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì¤Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setZoom(v) {
  zoom = Math.max(0.3, Math.min(2, v));
  const w = document.getElementById('scalewrap');
  w.style.transform = `scale(${zoom})`;
  w.style.transformOrigin = 'top center';
  document.getElementById('zdisp').textContent = Math.round(zoom*100)+'%';
}
function zIn()  { setZoom(Math.round((zoom+0.1)*10)/10); }
function zOut() { setZoom(Math.round((zoom-0.1)*10)/10); }
function zFit() { const aw=window.innerWidth-80,ah=window.innerHeight-220; setZoom(Math.min(1,aw/794,ah/1123)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í† ìŠ¤íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tT;
function toast(m) {
  const t=document.getElementById('toast');
  t.textContent=m; t.classList.add('show');
  clearTimeout(tT); tT=setTimeout(()=>t.classList.remove('show'),2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì „ì—­ ì´ë²¤íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('click', e=>{
  if (!e.target.closest('[data-idx],[data-ct],[data-hdr-page],.fmtbar')) {
    sel.clear(); refreshSel(); refreshFmtBar();
  }
});
document.addEventListener('keydown', e=>{
  if ((e.ctrlKey||e.metaKey)&&e.key==='z'&&!e.shiftKey) { e.preventDefault(); undo(); }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì´ˆê¸° ì‹¤í–‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
pages.push({slots:[]});
ensureSlots(pages[0]);
renderAll();
setZoom(0.9);
</script>
</body>
</html>
