<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‚¬ì§„ëŒ€ì§€ ì‘ì„±</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root {
  --bg: #0f1117; --bg2: #171b24; --bg3: #1e2330; --bg4: #252a38;
  --border: #2c3347; --orange: #f97316; --text: #f1f5f9;
  --muted: #64748b; --muted2: #94a3b8; --green: #22c55e;
  --sheet-bg: #fff; --sheet-text: #111; --sheet-border: #222;
  --sheet-light: #e8e8e8;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
body::before { content:''; position:fixed; inset:0; z-index:0;
  background-image: linear-gradient(rgba(249,115,22,.025) 1px, transparent 1px),
  linear-gradient(90deg, rgba(249,115,22,.025) 1px, transparent 1px);
  background-size: 40px 40px; pointer-events: none; }

/* â”€â”€ íˆ´ë°” â”€â”€ */
.toolbar {
  position: sticky; top: 0; z-index: 100;
  background: rgba(15,17,23,.96); backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px; display: flex; align-items: center; height: 54px; gap: 12px;
}
.toolbar-logo { font-family: 'Noto Serif KR', serif; font-size: 15px; font-weight: 700; color: var(--orange); margin-right: 8px; }
.toolbar-title { font-size: 13px; color: var(--muted2); }
.toolbar-right { margin-left: auto; display: flex; gap: 8px; }
.btn { padding: 7px 16px; border-radius: 7px; font-size: 12px; font-weight: 600;
  cursor: pointer; border: 1px solid var(--border); background: var(--bg3);
  color: var(--muted2); transition: all .15s; font-family: 'Noto Sans KR', sans-serif; white-space: nowrap; }
.btn:hover { color: var(--text); border-color: var(--muted); }
.btn.primary { background: var(--orange); border-color: var(--orange); color: #fff; }
.btn.primary:hover { background: #ea6c0a; }
.btn.success { background: var(--green); border-color: var(--green); color: #fff; }
.btn.success:hover { background: #16a34a; }
.btn.ghost { background: transparent; border-color: var(--border); }

/* â”€â”€ ì„¤ì • íŒ¨ë„ â”€â”€ */
.settings-panel {
  position: relative; z-index: 1;
  max-width: 900px; margin: 20px auto; padding: 0 20px;
}
.settings-card {
  background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
  padding: 16px 20px; display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
}
.setting-group { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 180px; }
.setting-group label { font-size: 11px; color: var(--muted); font-weight: 600; letter-spacing: .06em; }
.setting-group input, .setting-group select {
  background: var(--bg3); border: 1px solid var(--border); border-radius: 7px;
  padding: 8px 11px; color: var(--text); font-size: 13px; font-family: 'Noto Sans KR', sans-serif;
}
.setting-group input:focus, .setting-group select:focus { outline: none; border-color: var(--orange); }
.setting-group input::placeholder { color: var(--muted); }

/* â”€â”€ ë¯¸ë¦¬ë³´ê¸° ë˜í¼ â”€â”€ */
.preview-wrapper {
  position: relative; z-index: 1;
  display: flex; justify-content: center; padding: 20px 20px 60px;
}
.preview-scale-wrap { transform-origin: top center; }

/* â”€â”€ A4 ìš©ì§€ â”€â”€ */
.sheet {
  width: 794px; min-height: 1123px;
  background: var(--sheet-bg); color: var(--sheet-text);
  box-shadow: 0 8px 40px rgba(0,0,0,.6);
  font-family: 'Malgun Gothic', sans-serif;
  padding: 56.7px; /* 1.5cm = 56.7px */
  box-sizing: border-box;
  position: relative;
}

/* â”€â”€ í—¤ë” â”€â”€ */
.sheet-header {
  margin-bottom: 8px;
}
.sheet-header-top {
  display: flex; align-items: baseline; justify-content: space-between;
  margin-bottom: 4px;
}
.sheet-title {
  font-family: 'Noto Serif KR', serif; font-size: 19px; font-weight: 700;
  letter-spacing: .05em; line-height: 1.2; outline: none; cursor: text;
}
.sheet-title:focus { background: #fffbf0; }
.sheet-deco-line {
  width: 100%; height: auto; display: block; margin: 5px 0 8px;
}
.sheet-meta { display: flex; align-items: center; gap: 0; }
.sheet-meta-label { font-size: 11px; font-weight: 700; padding: 0 8px 0 0; white-space: nowrap; }
.sheet-meta-value {
  font-size: 12px; padding: 2px 4px; min-width: 220px;
  border: none; outline: none;
  font-family: 'Noto Sans KR', sans-serif; background: transparent; color: var(--sheet-text);
}
.sheet-meta-value:focus { background: #fffbf0; }

/* â”€â”€ 6ì¹¸ ê·¸ë¦¬ë“œ â”€â”€ */
.photo-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 5px;
  width: 100%;
  align-items: start;
}
.photo-slot {
  border: 1.5px solid var(--sheet-border);
  display: flex; flex-direction: column;
}

/* ì‚¬ì§„ ì˜ì—­ */
.photo-area {
  aspect-ratio: 4/3;
  background: #f0f0f0;
  border-bottom: 1px solid var(--sheet-border);
  display: flex; align-items: center; justify-content: center;
  position: relative; cursor: pointer; overflow: hidden;
  transition: background .15s;
  width: 100%;
}
.photo-area:hover { background: #e8e8e8; }
.photo-area img { width: 100%; height: 100%; object-fit: cover; display: block; }
.photo-area .upload-hint {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  color: #999; font-size: 12px; pointer-events: none; text-align: center;
}
.photo-area .upload-hint svg { opacity: .4; }
.photo-area input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.photo-area .del-photo {
  position: absolute; top: 5px; right: 5px;
  background: rgba(239,68,68,.85); color: #fff; border: none;
  width: 22px; height: 22px; border-radius: 4px; font-size: 12px;
  cursor: pointer; display: none; align-items: center; justify-content: center;
  z-index: 5;
}
.photo-area:hover .del-photo { display: flex; }

/* ë©”íƒ€ í–‰ */
.slot-meta {
  display: grid; grid-template-columns: var(--loc-label-w,38px) 1fr var(--date-label-w,38px) 1fr;
  border-bottom: 1px solid var(--sheet-border); min-height: 22px;
}
.slot-meta-label {
  font-size: 10px; font-weight: 700; padding: 3px 5px;
  border-right: 1px solid var(--sheet-border); display: flex; align-items: center;
  background: #f5f5f5; white-space: nowrap; color: #444; flex-shrink: 0; cursor: pointer;
}
.slot-meta-input {
  font-size: 11px; padding: 3px 5px; border: none; outline: none;
  font-family: 'Noto Sans KR', sans-serif; background: transparent;
  color: var(--sheet-text); width: 100%; min-width: 0;
}
.slot-meta-input:focus { outline: none; }
.slot-meta-sep { border-right: 1px solid var(--sheet-border); }

/* ë‚´ìš© í–‰ */
.slot-desc-row { display: flex; min-height: 28px; }
.slot-desc-label { min-width: var(--desc-label-w,38px); }
.slot-desc-label {
  font-size: 10px; font-weight: 700; padding: 3px 5px;
  border-right: 1px solid var(--sheet-border);
  background: #f5f5f5; display: flex; align-items: flex-start;
  padding-top: 4px; white-space: nowrap; color: #444; flex-shrink: 0; cursor: pointer;
}
.slot-desc-input {
  flex: 1; font-size: 11px; padding: 3px 5px; border: none; outline: none;
  font-family: 'Noto Sans KR', sans-serif; resize: none; background: transparent;
  color: var(--sheet-text); line-height: 1.5; min-height: 26px; width: 100%; min-width: 0;
}
.slot-desc-input:focus { outline: none; }

/* ë²ˆí˜¸ ë°°ì§€ */
.slot-num {
  position: absolute; top: 5px; left: 5px;
  background: rgba(0,0,0,.55); color: #fff; font-size: 10px; font-weight: 700;
  padding: 1px 6px; border-radius: 3px; pointer-events: none;
}

/* â”€â”€ ì¸ì‡„ ìŠ¤íƒ€ì¼ â”€â”€ */
@media print {
  body { background: white !important; }
  body::before { display: none; }
  .toolbar, .settings-panel, .print-hide { display: none !important; }
  .preview-wrapper { padding: 0; }
  .preview-scale-wrap { transform: none !important; }
  .sheet { box-shadow: none; width: 100%; padding: 15mm; }
  .photo-area input[type=file], .del-photo { display: none !important; }
  .upload-hint { display: none !important; }
  @page { size: A4; margin: 0; }
}

/* â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ */
.toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--bg3); border: 1px solid var(--border); border-radius: 8px;
  padding: 10px 20px; font-size: 13px; color: var(--text); z-index: 500;
  opacity: 0; transition: all .3s; pointer-events: none; }
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* â”€â”€ í¬ë§· íˆ´ë°” â”€â”€ */
.format-bar {
  position: sticky; top: 54px; z-index: 99;
  background: rgba(23,27,36,.97); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0 24px; display: flex; align-items: center; height: 40px; gap: 6px;
  flex-wrap: nowrap; overflow-x: auto;
}
.format-bar::-webkit-scrollbar { height: 3px; }
.format-bar::-webkit-scrollbar-thumb { background: var(--border); }
.fmt-sep { width: 1px; height: 20px; background: var(--border); margin: 0 4px; flex-shrink: 0; }
.fmt-label { font-size: 10px; color: var(--muted); white-space: nowrap; }
.fmt-select {
  background: var(--bg3); border: 1px solid var(--border); border-radius: 5px;
  color: var(--muted2); font-size: 11px; padding: 3px 6px;
  font-family: 'Noto Sans KR', sans-serif; cursor: pointer; height: 26px;
}
.fmt-select:focus { outline: none; border-color: var(--orange); }
.fmt-btn {
  background: var(--bg3); border: 1px solid var(--border); border-radius: 5px;
  color: var(--muted2); font-size: 12px; padding: 0 8px; height: 26px;
  cursor: pointer; font-family: inherit; transition: all .15s; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; min-width: 26px;
}
.fmt-btn:hover { color: var(--text); border-color: var(--muted); }
.fmt-btn.active { background: var(--orange); border-color: var(--orange); color: #fff; }
.fmt-hint { font-size: 10px; color: var(--muted); margin-left: auto; white-space: nowrap; }

/* â”€â”€ ì…€ ì„ íƒ â”€â”€ */
.photo-slot { cursor: default; }
.cell-selectable {
  position: relative;
  transition: background .1s;
}
/* input/textareaëŠ” í…ìŠ¤íŠ¸ ì»¤ì„œ ìœ ì§€ */
input.cell-selectable, textarea.cell-selectable { cursor: text; }
/* í—¤ë” ì…€ì€ í¬ì¸í„° */
div.cell-selectable { cursor: pointer; }
.cell-selectable:hover { background: #fff8f0 !important; }
.cell-selectable.cell-selected {
  background: #fff3e0 !important;
  outline: 2px solid #f97316;
  outline-offset: -1px;
}

/* â”€â”€ ìœ„ì¹˜+ì¼ì‹œ ë³‘í•© â”€â”€ */
.slot-meta.meta-merged {
  grid-template-columns: auto 1fr;
}
.slot-meta.meta-merged .hide-on-merge { display: none; }

</style>
</head>
<body>

<!-- íˆ´ë°” -->
<div class="toolbar print-hide">
  <div class="toolbar-logo">ğŸ“‹</div>
  <div class="toolbar-title">ì‚¬ì§„ëŒ€ì§€ ì‘ì„±</div>
  <div class="toolbar-right">
    <button class="btn ghost" onclick="resetForm()">â†º ì´ˆê¸°í™”</button>
    <button class="btn ghost" onclick="addSlot()" id="addSlotBtn">+ ì¹¸ ì¶”ê°€</button>
    <button class="btn ghost" onclick="removeSlot()" id="rmSlotBtn" style="display:none">âˆ’ ì¹¸ ì œê±°</button>
    <button class="btn success" onclick="exportExcel()">ğŸ“Š ì—‘ì…€ ì €ì¥</button>
    <button class="btn primary" onclick="printPDF()">ğŸ–¨ï¸ PDF ì €ì¥</button>
  </div>
</div>

<!-- í¬ë§· íˆ´ë°” -->
<div class="format-bar print-hide" id="formatBar">
  <span class="fmt-label">ê¸€ê¼´</span>
  <select class="fmt-select" id="fmtFont" onchange="applyFormat('font',this.value)" style="width:110px">
    <option value="'Noto Sans KR',sans-serif">Noto Sans KR</option>
    <option value="'Noto Serif KR',serif">Noto Serif KR</option>
    <option value="'Malgun Gothic',sans-serif" selected>ë§‘ì€ ê³ ë”•</option>
    <option value="'Dotum',sans-serif">ë‹ì›€</option>
    <option value="'Batang',serif">ë°”íƒ•</option>
    <option value="Arial,sans-serif">Arial</option>
  </select>

  <div class="fmt-sep"></div>
  <span class="fmt-label">í¬ê¸°</span>
  <button class="fmt-btn" onclick="quickFontSize(-1)" title="ê¸€ì”¨ ì¤„ì´ê¸°" style="font-size:10px">â–¼</button>
  <input type="number" class="fmt-select" id="fmtSize" min="6" max="72" value="11"
    style="width:46px;text-align:center;-moz-appearance:textfield;"
    oninput="applyFormat('size',this.value+'px')">
  <button class="fmt-btn" onclick="quickFontSize(1)" title="ê¸€ì”¨ í‚¤ìš°ê¸°" style="font-size:10px">â–²</button>

  <div class="fmt-sep"></div>
  <span class="fmt-label">ì •ë ¬</span>
  <button class="fmt-btn" id="fmtLeft"   onclick="applyFormat('align','left')"    title="ì™¼ìª½ ì •ë ¬"><svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="5" width="18" height="2"/><rect x="3" y="10" width="12" height="2"/><rect x="3" y="15" width="15" height="2"/><rect x="3" y="20" width="9" height="2"/></svg></button>
  <button class="fmt-btn" id="fmtCenter" onclick="applyFormat('align','center')"  title="ê°€ìš´ë° ì •ë ¬"><svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="5" width="18" height="2"/><rect x="6" y="10" width="12" height="2"/><rect x="4" y="15" width="16" height="2"/><rect x="7" y="20" width="10" height="2"/></svg></button>
  <button class="fmt-btn" id="fmtRight"  onclick="applyFormat('align','right')"   title="ì˜¤ë¥¸ìª½ ì •ë ¬"><svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="5" width="18" height="2"/><rect x="9" y="10" width="12" height="2"/><rect x="6" y="15" width="15" height="2"/><rect x="12" y="20" width="9" height="2"/></svg></button>

  <div class="fmt-sep"></div>
  <span class="fmt-label">êµµê¸°</span>
  <button class="fmt-btn" id="fmtBold"   onclick="applyFormat('bold',null)"       title="êµµê²Œ"><b>B</b></button>

  <div class="fmt-sep"></div>
  <button class="fmt-btn" onclick="mergeSelected()"  title="ìœ„ì¹˜+ì¼ì‹œ ì…€ ì„ íƒ í›„ ë³‘í•©">âŠ ë³‘í•©</button>
  <button class="fmt-btn" onclick="splitSelected()"  title="ë³‘í•©ëœ ì…€ ì„ íƒ í›„ ë¶„í• ">âŠŸ ë¶„í• </button>

  <div class="fmt-sep"></div>
  <span class="fmt-label">ì„¸ë¡œ</span>
  <button class="fmt-btn" onclick="adjustSize('h',-10)" title="í–‰ ë†’ì´ ì¤„ì´ê¸°">ï¼</button>
  <span id="sizeDispH" style="font-size:10px;color:#94a3b8;min-width:30px;text-align:center;">â€”</span>
  <button class="fmt-btn" onclick="adjustSize('h',10)"  title="í–‰ ë†’ì´ ëŠ˜ë¦¬ê¸°">ï¼‹</button>
  <div class="fmt-sep"></div>
  <span class="fmt-label">ê°€ë¡œ</span>
  <button class="fmt-btn" onclick="adjustSize('w',-4)" title="ë¼ë²¨ ë„ˆë¹„ ì¤„ì´ê¸°">ï¼</button>
  <span id="sizeDispW" style="font-size:10px;color:#94a3b8;min-width:30px;text-align:center;">â€”</span>
  <button class="fmt-btn" onclick="adjustSize('w',4)"  title="ë¼ë²¨ ë„ˆë¹„ ëŠ˜ë¦¬ê¸°">ï¼‹</button>

  <span class="fmt-hint" id="fmtHint">ì¹¸ì„ í´ë¦­í•˜ë©´ ì„ íƒë©ë‹ˆë‹¤ Â· Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ ì„ íƒ</span>
</div>


<!-- ì„¤ì • íŒ¨ë„ -->
<div class="settings-panel print-hide">
  <div class="settings-card">
    <div class="setting-group" style="min-width:240px;flex:2">
      <label>í˜„ì¥ëª…</label>
      <input type="text" id="siteName" placeholder="í˜„ì¥ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="syncSiteName(this.value)">
    </div>
    <div class="setting-group">
      <label>ë¬¸ì„œ ì œëª©</label>
      <input type="text" id="docTitle" value="ì•ˆì „ê´€ë¦¬ë¹„ ì¦ë¹™ ì‚¬ì§„ëŒ€ì§€" oninput="syncTitle(this.value)">
    </div>
    <div class="setting-group" style="min-width:140px">
      <label>ì¹¸ ìˆ˜</label>
      <select onchange="setSlotCount(+this.value)">
        <option value="2">2ì¹¸ (1Ã—2)</option>
        <option value="4">4ì¹¸ (2Ã—2)</option>
        <option value="6" selected>6ì¹¸ (3Ã—2)</option>
        <option value="8">8ì¹¸ (4Ã—2)</option>
      </select>
    </div>
  </div>
</div>

<!-- A4 ë¯¸ë¦¬ë³´ê¸° -->
<div class="preview-wrapper">
  <div class="preview-scale-wrap" id="scaleWrap">
    <div class="sheet" id="sheet">

      <!-- í—¤ë” -->
      <div class="sheet-header">
        <div class="sheet-header-top">
          <div class="sheet-title cell-selectable" id="sheetTitle" contenteditable="true" data-cell="title" onclick="selectHeaderCell('title',event)">ì•ˆì „ê´€ë¦¬ë¹„ ì¦ë¹™ ì‚¬ì§„ëŒ€ì§€</div>
          <div class="sheet-meta">
            <div class="sheet-meta-label cell-selectable" id="sheetSiteLabel" data-cell="siteLabel" onclick="selectHeaderCell('siteLabel',event)">í˜„ì¥ëª… :</div>
            <input class="sheet-meta-value cell-selectable" id="sheetSite" data-cell="site" placeholder="í˜„ì¥ëª…" oninput="document.getElementById('siteName').value=this.value" onclick="selectHeaderCell('site',event)">
          </div>
        </div>
        <img class="sheet-deco-line" src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAAKB9ADASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAYHBQj/xAAmEAEAAQIEBgIDAAAAAAAAAAAAAQIDBAUGEQcSEyEiURRBMWGB/8QAGQEBAAMBAQAAAAAAAAAAAAAAAAQFBgcD/8QAIREBAAIBAwQDAAAAAAAAAAAAAAECAwQFESExQnEVQZH/2gAMAwEAAhEDEQA/APOOlMy+dgIt3Kt79rxq/cfUuyhNEzMZzERMxE0Tuu3RNm1N9Rpa2v3jp+MfuWGuHPMV7T1AFoggAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJ7V2cXMFFvD4W5NF+aormqJ70xH4aZozO7ee5HaxcTHWiOW9T6qhhupJmc7xO8zPn9rjgfVV8zH0c08vJTO2/bfdzDf8ANbU572t4zxHpM3nbsXxkZfKvE8+/pqgDNsCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJjiLqCMiyOvo17Yu/4WvdPur+KdjfGeqqdTW6ZqmaYsxtG/aHtgpF7xErjYtJTVa2tMnaOvvh/9k=" alt="">
      </div>

      <!-- 6ì¹¸ ê·¸ë¦¬ë“œ -->
      <div class="photo-grid" id="photoGrid"></div>

    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let slotCount = 6;
// slotData[i].cells = { loc:{font,size,align,bold}, date:{...}, desc:{...} }
// slotData[i].metaMerged = false  (ìœ„ì¹˜+ì¼ì‹œ ë³‘í•© ì—¬ë¶€)
const slotData = [];
// ì„ íƒëœ ì…€: Set of "slotIdx:cellType" (cellType = loc|date|desc)
const selectedCells = new Set();
// í—¤ë” ì…€ í¬ë§·
const headerCells = {
  title:     { font:"'Malgun Gothic',sans-serif", fontSize:'19px', align:'left', bold:true  },
  site:      { font:"'Malgun Gothic',sans-serif", fontSize:'12px', align:'left', bold:false },
  siteLabel: { font:"'Malgun Gothic',sans-serif", fontSize:'11px', align:'left', bold:true  }
};
let selectedHeaderCell = null; // 'title' | 'site' | null

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function defaultCell() {
  return { font:"'Malgun Gothic',sans-serif", fontSize:'11px', align:'left', bold:false };
}
function defaultLabel() {
  return { font:"'Malgun Gothic',sans-serif", fontSize:'10px', align:'left', bold:true };
}
function initSlots(n) {
  while (slotData.length < n) slotData.push({
    imgSrc:'', location:'', date:'', desc:'',
    metaMerged: false, rowHeight: 220, metaRowHeight: 22, descRowHeight: 28, locLabelW:38, dateLabelW:38, descLabelW:38,
    cells: { loc: defaultCell(), date: defaultCell(), desc: defaultCell(),
             locLabel: defaultLabel(), dateLabel: defaultLabel(), descLabel: defaultLabel() }
  });
  selectedCells.clear();
  renderGrid();
}

function renderGrid() {
  const grid = document.getElementById('photoGrid');
  grid.innerHTML = '';
  for (let i = 0; i < slotCount; i++) {
    grid.appendChild(makeSlot(i));
  }
  if (slotCount % 2 !== 0) {
    const empty = document.createElement('div');
    empty.style.cssText = 'border:1.5px dashed #ddd;display:flex;align-items:center;justify-content:center;color:#ccc;font-size:12px;';
    empty.textContent = 'ë¹ˆ ì¹¸';
    grid.appendChild(empty);
  }
  document.getElementById('addSlotBtn').textContent = `+ ì¹¸ ì¶”ê°€ (í˜„ì¬ ${slotCount}ì¹¸)`;
  document.getElementById('rmSlotBtn').style.display = slotCount > 2 ? '' : 'none';
  updateFmtHint();
}

function makeSlot(i) {
  const d = slotData[i];
  const div = document.createElement('div');
  div.className = 'photo-slot';
  div.dataset.idx = i;
  div.style.setProperty('--loc-label-w',  (d.locLabelW||38)+'px');
  div.style.setProperty('--date-label-w', (d.dateLabelW||38)+'px');
  div.style.setProperty('--desc-label-w', (d.descLabelW||38)+'px');

  // ì‚¬ì§„ ì˜ì—­
  const pa = document.createElement('div');
  pa.className = 'photo-area';
  pa.style.height = d.rowHeight + 'px';
  pa.style.aspectRatio = 'unset';
  pa.innerHTML = `
    <span class="slot-num">${i+1}</span>
    ${d.imgSrc
      ? `<img src="${d.imgSrc}">`
      : `<div class="upload-hint">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/>
            <path d="m21 15-5-5L5 21"/>
          </svg>
          <span>í´ë¦­í•˜ì—¬ ì‚¬ì§„ ì¶”ê°€<br><small>JPG, PNG, BMP ë“±</small></span>
        </div>`}
    ${d.imgSrc ? `<button class="del-photo" onclick="event.stopPropagation();delPhoto(${i})">âœ•</button>` : ''}
    <input type="file" accept="image/*" onchange="onPhotoSelect(event,${i})">`;

  // â”€â”€ ìœ„ì¹˜/ì¼ì‹œ í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const meta = document.createElement('div');
  meta.className = 'slot-meta' + (d.metaMerged ? ' meta-merged' : '');
  meta.style.minHeight = d.metaRowHeight + 'px';

  function cellStyle(ct) {
    const f = d.cells[ct] || d.cells[ct.replace('Label','')] || {font:"'Noto Sans KR',sans-serif",fontSize:'10px',align:'left',bold:true};
    return `font-family:${f.font};font-size:${f.fontSize};text-align:${f.align};font-weight:${f.bold?'700':'400'}`;
  }
  function isCellSel(ct) { return selectedCells.has(`${i}:${ct}`); }

  // ìœ„ì¹˜ label
  const lblLoc = document.createElement('div');
  lblLoc.className = 'slot-meta-label cell-selectable' + (isCellSel('locLabel') ? ' cell-selected' : '');
  lblLoc.dataset.cell = 'locLabel';
  lblLoc.textContent = 'ìœ„ì¹˜';
  lblLoc.style.cssText = cellStyle('locLabel');
  lblLoc.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'locLabel',e.ctrlKey||e.metaKey); });

  // ìœ„ì¹˜ input
  const inpLoc = document.createElement('input');
  inpLoc.dataset.cell = 'loc';
  inpLoc.className = 'slot-meta-input cell-selectable' + (isCellSel('loc') ? ' cell-selected' : '');
  inpLoc.value = d.location;
  inpLoc.placeholder = 'ì´¬ì˜ ìœ„ì¹˜';
  inpLoc.style.cssText = cellStyle('loc');
  inpLoc.oninput = e => { slotData[i].location = e.target.value; };
  inpLoc.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'loc',e.ctrlKey||e.metaKey); });

  // ì¼ì‹œ label (ë³‘í•©ì‹œ ìˆ¨ê¹€)
  const lblDate = document.createElement('div');
  lblDate.className = 'slot-meta-label slot-meta-sep hide-on-merge cell-selectable' + (isCellSel('dateLabel') ? ' cell-selected' : '');
  lblDate.dataset.cell = 'dateLabel';
  lblDate.textContent = 'ì¼ì‹œ';
  lblDate.style.cssText = cellStyle('dateLabel');
  lblDate.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'dateLabel',e.ctrlKey||e.metaKey); });

  // ì¼ì‹œ input (ë³‘í•©ì‹œ ìˆ¨ê¹€)
  const inpDate = document.createElement('input');
  inpDate.dataset.cell = 'date';
  inpDate.className = 'slot-meta-input cell-selectable hide-on-merge' + (isCellSel('date') ? ' cell-selected' : '');
  inpDate.value = d.date;
  inpDate.placeholder = 'YYYY-MM-DD';
  inpDate.style.cssText = cellStyle('date');
  inpDate.oninput = e => { slotData[i].date = e.target.value; };
  inpDate.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'date',e.ctrlKey||e.metaKey); });

  meta.append(lblLoc, inpLoc, lblDate, inpDate);

  // â”€â”€ ë‚´ìš© í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const descRow = document.createElement('div');
  descRow.className = 'slot-desc-row';
  descRow.style.minHeight = d.descRowHeight + 'px';

  const lblDesc = document.createElement('div');
  lblDesc.className = 'slot-desc-label cell-selectable' + (isCellSel('descLabel') ? ' cell-selected' : '');
  lblDesc.dataset.cell = 'descLabel';
  lblDesc.textContent = 'ë‚´ìš©';
  lblDesc.style.cssText = cellStyle('descLabel');
  lblDesc.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'descLabel',e.ctrlKey||e.metaKey); });

  const taDesc = document.createElement('textarea');
  taDesc.dataset.cell = 'desc';
  taDesc.className = 'slot-desc-input cell-selectable' + (isCellSel('desc') ? ' cell-selected' : '');
  taDesc.rows = 2;
  taDesc.placeholder = 'ì‚¬ì§„ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”';
  taDesc.style.cssText = cellStyle('desc');
  taDesc.value = d.desc;
  taDesc.oninput = e => { slotData[i].desc = e.target.value; };
  taDesc.addEventListener('click', e => { e.stopPropagation(); selectCell(i,'desc',e.ctrlKey||e.metaKey); });

  descRow.append(lblDesc, taDesc);
  div.append(pa, meta, descRow);
  return div;
}

// â”€â”€ í—¤ë” ì…€ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectHeaderCell(cellType, e) {
  e && e.stopPropagation();
  // ìŠ¬ë¡¯ ì„ íƒ í•´ì œ
  selectedCells.clear();
  document.querySelectorAll('.cell-selected').forEach(el => el.classList.remove('cell-selected'));

  selectedHeaderCell = (selectedHeaderCell === cellType) ? null : cellType;
  // ì‹œê°ì  í‘œì‹œ
  ['sheetTitle','sheetSite','sheetSiteLabel'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('cell-selected');
  });
  if (selectedHeaderCell) {
    const idMap2 = {title:'sheetTitle', site:'sheetSite', siteLabel:'sheetSiteLabel'};
    const target = idMap2[selectedHeaderCell];
    document.getElementById(target)?.classList.add('cell-selected');
  }
  updateFmtBarHeader();
  updateFmtHint();
}

function updateFmtBarHeader() {
  if (!selectedHeaderCell) return;
  const f = headerCells[selectedHeaderCell];
  if (!f) return;
  const ff=document.getElementById('fmtFont'), fs=document.getElementById('fmtSize');
  if(ff) ff.value=f.font;
  if(fs) { const pxVal=parseInt(f.fontSize||'11'); fs.value=pxVal; }
  ['fmtLeft','fmtCenter','fmtRight'].forEach((id,idx)=>{
    document.getElementById(id)?.classList.toggle('active',f.align===['left','center','right'][idx]);
  });
  document.getElementById('fmtBold')?.classList.toggle('active', f.bold);
}

// â”€â”€ ì…€ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectCell(slotIdx, cellType, multi=false) {
  const key = `${slotIdx}:${cellType}`;
  if (!multi) selectedCells.clear();
  if (selectedCells.has(key)) selectedCells.delete(key);
  else selectedCells.add(key);

  // DOM í´ë˜ìŠ¤ë§Œ ì—…ë°ì´íŠ¸
  document.querySelectorAll('.cell-selectable').forEach(el => {
    const si = +el.closest('[data-idx]')?.dataset.idx;
    const ct = el.dataset.cell;
    if (!isNaN(si) && ct) el.classList.toggle('cell-selected', selectedCells.has(`${si}:${ct}`));
  });

  // data-cell ì†ì„±ìœ¼ë¡œ ê° inputì— cellType íƒœê·¸ í•„ìš”
  updateFmtBar(); updateFmtHint(); updateSizeDisplay();
}

function updateFmtHint() {
  const hint = document.getElementById('fmtHint');
  if (!hint) return;
  const sel = [...selectedCells];
  const labels = {'loc':'ìœ„ì¹˜','date':'ì¼ì‹œ','desc':'ë‚´ìš©','locLabel':'ìœ„ì¹˜ ë¼ë²¨','dateLabel':'ì¼ì‹œ ë¼ë²¨','descLabel':'ë‚´ìš© ë¼ë²¨'};
  if (selectedHeaderCell) {
    const nm = {title:'ë¬¸ì„œ ì œëª©', site:'í˜„ì¥ëª… ì…ë ¥ë€', siteLabel:'í˜„ì¥ëª… ë¼ë²¨'};
    hint.textContent = (nm[selectedHeaderCell]||selectedHeaderCell) + ' ì„ íƒë¨'; return;
  }
  if (!sel.length) hint.textContent = 'ì…€ í´ë¦­â†’ì„ íƒ Â· Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ ì„ íƒ í›„ í¬ë§·/ë³‘í•© ì ìš©';
  else hint.textContent = sel.map(k => { const [si,ct]=k.split(':'); return `${+si+1}ë²ˆ ${labels[ct]||ct}`; }).join(', ') + ' ì„ íƒë¨';
}

function updateFmtBar() {
  if (!selectedCells.size) return;
  const [si, ct] = [...selectedCells][0].split(':');
  const f = slotData[+si]?.cells[ct];
  if (!f) return;
  if (!f) return;
  const ff=document.getElementById('fmtFont'), fs=document.getElementById('fmtSize');
  if(ff) ff.value=f.font; if(fs) fs.value=f.fontSize;
  ['fmtLeft','fmtCenter','fmtRight'].forEach((id,idx)=>{
    const btn=document.getElementById(id);
    if(btn) btn.classList.toggle('active',f.align===['left','center','right'][idx]);
  });
  const bb=document.getElementById('fmtBold');
  if(bb) bb.classList.toggle('active', f.bold);
}

// â”€â”€ í¬ë§· ì ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function quickFontSize(delta) {
  const inp = document.getElementById('fmtSize');
  const cur = parseInt(inp?.value||'11');
  const next = Math.max(6, Math.min(72, cur + delta));
  if (inp) inp.value = next;
  applyFormat('size', next + 'px');
}

function updateSizeDisplay() {
  const hEl = document.getElementById('sizeDispH');
  const wEl = document.getElementById('sizeDispW');
  if (!hEl || !wEl) return;
  if (!selectedCells.size) { hEl.textContent='â€”'; wEl.textContent='â€”'; return; }
  const [si, ct] = [...selectedCells][0].split(':');
  const i = +si; const d = slotData[i];
  if (!d) return;
  // ì„¸ë¡œ
  if (ct==='loc'||ct==='locLabel'||ct==='date'||ct==='dateLabel') {
    hEl.textContent = (d.metaRowHeight||22)+'px';
  } else if (ct==='desc'||ct==='descLabel') {
    hEl.textContent = (d.descRowHeight||28)+'px';
  } else { hEl.textContent='â€”'; }
  // ê°€ë¡œ
  if (ct==='loc'||ct==='locLabel') wEl.textContent=(d.locLabelW||38)+'px';
  else if (ct==='date'||ct==='dateLabel') wEl.textContent=(d.dateLabelW||38)+'px';
  else if (ct==='desc'||ct==='descLabel') wEl.textContent=(d.descLabelW||38)+'px';
  else wEl.textContent='â€”';
}

function applyFormat(type, value) {
  // í—¤ë” ì…€ ì„ íƒëœ ê²½ìš°
  if (selectedHeaderCell) {
    const f = headerCells[selectedHeaderCell];
    if (type==='font')  f.font     = value;
    if (type==='size')  f.fontSize = value;
    if (type==='align') f.align    = value;
    if (type==='bold')  f.bold     = !f.bold;
    const idMap = {title:'sheetTitle', site:'sheetSite', siteLabel:'sheetSiteLabel'};
    const el = document.getElementById(idMap[selectedHeaderCell]);
    if (el) {
      el.style.fontFamily = f.font;
      el.style.fontSize   = f.fontSize;
      el.style.textAlign  = f.align;
      el.style.fontWeight = f.bold ? '700' : '400';
    }
    updateFmtBarHeader();
    return;
  }
  if (!selectedCells.size) { showToast('ë¨¼ì € ì…€ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”'); return; }
  selectedCells.forEach(key => {
    const [si, ct] = key.split(':');
    const f = slotData[+si]?.cells[ct];
    if (!f) return;
    if (type==='font')  f.font     = value;
    if (type==='size')  f.fontSize = value;
    if (type==='align') f.align    = value;
    if (type==='bold')  f.bold     = !f.bold;
    // DOM ì§ì ‘ ì—…ë°ì´íŠ¸
    const slot = document.querySelector(`[data-idx="${si}"]`);
    if (!slot) return;
    const target = slot.querySelector(`[data-cell="${ct}"]`);
    if (target) {
      target.style.fontFamily  = f.font;
      target.style.fontSize    = f.fontSize;
      target.style.textAlign   = f.align;
      target.style.fontWeight  = f.bold ? '700' : '400';
    }
  });
  updateFmtBar();
}

// â”€â”€ ì…€ í¬ê¸° ì¡°ì ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// axis: 'h'=ì„¸ë¡œ(ë†’ì´), 'w'=ê°€ë¡œ(ë¼ë²¨ë„ˆë¹„)
function applyLabelWidths(i) {
  const slot = document.querySelector(`[data-idx="${i}"]`);
  if (!slot) return;
  slot.style.setProperty('--loc-label-w',  (slotData[i].locLabelW||38)+'px');
  slot.style.setProperty('--date-label-w', (slotData[i].dateLabelW||38)+'px');
  slot.style.setProperty('--desc-label-w', (slotData[i].descLabelW||38)+'px');
}

function adjustSize(axis, delta) {
  // ì„ íƒëœ ì…€ì—ì„œ ìŠ¬ë¡¯ ì¸ë±ìŠ¤ ì¶”ì¶œ
  const targetSlots = selectedCells.size > 0
    ? [...new Set([...selectedCells].map(k => +k.split(':')[0]))]
    : null;

  if (axis === 'h') {
    if (!selectedCells.size) {
      // ì„ íƒ ì—†ìŒ â†’ ì „ì²´ ì‚¬ì§„ ì˜ì—­ ë†’ì´
      for (let i = 0; i < slotCount; i++) {
        slotData[i].rowHeight = Math.max(60, Math.min(600, (slotData[i].rowHeight||220) + delta));
        const pa = document.querySelector(`[data-idx="${i}"] .photo-area`);
        if (pa) pa.style.height = slotData[i].rowHeight + 'px';
      }
      showToast(`ì‚¬ì§„ ë†’ì´: ${slotData[0].rowHeight}px`);
      return;
    }
    // ì„ íƒëœ ì…€ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ í–‰ë§Œ ì¡°ì ˆ (í•´ë‹¹ ìŠ¬ë¡¯ë§Œ)
    selectedCells.forEach(key => {
      const [si, ct] = key.split(':');
      const i = +si;
      const slot = document.querySelector(`[data-idx="${i}"]`);
      if (!slot) return;

      if (ct === 'loc' || ct === 'locLabel' || ct === 'date' || ct === 'dateLabel') {
        slotData[i].metaRowHeight = Math.max(16, Math.min(80, (slotData[i].metaRowHeight||22) + delta));
        const row = slot.querySelector('.slot-meta');
        if (row) row.style.minHeight = slotData[i].metaRowHeight + 'px';
        showToast(`1ë²ˆ ìœ„ì¹˜/ì¼ì‹œ í–‰ ë†’ì´: ${slotData[i].metaRowHeight}px`);
      } else if (ct === 'desc' || ct === 'descLabel') {
        slotData[i].descRowHeight = Math.max(20, Math.min(200, (slotData[i].descRowHeight||28) + delta));
        const row = slot.querySelector('.slot-desc-row');
        if (row) row.style.minHeight = slotData[i].descRowHeight + 'px';
        const ta = slot.querySelector('.slot-desc-input');
        if (ta) ta.style.minHeight = (slotData[i].descRowHeight - 2) + 'px';
        showToast(`${i+1}ë²ˆ ë‚´ìš© í–‰ ë†’ì´: ${slotData[i].descRowHeight}px`);
      }
    });
    updateSizeDisplay();

  } else if (axis === 'w') {
    // ê°€ë¡œ: ì„ íƒëœ ì…€ íƒ€ì…ë³„ë¡œ í•´ë‹¹ ë¼ë²¨ë§Œ ì¡°ì ˆ
    if (!selectedCells.size) {
      // ì„ íƒ ì—†ìœ¼ë©´ ì „ì²´ ìŠ¬ë¡¯ ëª¨ë“  ë¼ë²¨ ì¡°ì ˆ
      for (let i = 0; i < slotCount; i++) {
        slotData[i].locLabelW = slotData[i].dateLabelW = slotData[i].descLabelW =
          Math.max(24, Math.min(120, (slotData[i].locLabelW||38) + delta));
        applyLabelWidths(i);
      }
      showToast(`ì „ì²´ ë¼ë²¨ ë„ˆë¹„: ${slotData[0].locLabelW}px`);
      return;
    }
    selectedCells.forEach(key => {
      const [si, ct] = key.split(':');
      const i = +si;
      const slot = document.querySelector(`[data-idx="${i}"]`);
      if (!slot) return;
      if (ct === 'loc' || ct === 'locLabel') {
        // ìœ„ì¹˜ ë¼ë²¨ + ë‚´ìš© ë¼ë²¨ë§Œ ë³€ê²½ (ì¼ì‹œëŠ” ê·¸ëŒ€ë¡œ)
        slotData[i].locLabelW  = Math.max(24, Math.min(120, (slotData[i].locLabelW||38) + delta));
        slotData[i].descLabelW = slotData[i].locLabelW;
        applyLabelWidths(i);
        showToast(`${i+1}ë²ˆ ìœ„ì¹˜/ë‚´ìš© ë¼ë²¨: ${slotData[i].locLabelW}px`);
      } else if (ct === 'date' || ct === 'dateLabel') {
        slotData[i].dateLabelW = Math.max(24, Math.min(120, (slotData[i].dateLabelW||38) + delta));
        applyLabelWidths(i);
        showToast(`${i+1}ë²ˆ ì¼ì‹œ ë¼ë²¨: ${slotData[i].dateLabelW}px`);
      } else if (ct === 'desc' || ct === 'descLabel') {
        slotData[i].descLabelW = Math.max(24, Math.min(120, (slotData[i].descLabelW||38) + delta));
        applyLabelWidths(i);
        showToast(`${i+1}ë²ˆ ë‚´ìš© ë¼ë²¨: ${slotData[i].descLabelW}px`);
      }
    });
    updateSizeDisplay();
  }
}

// â”€â”€ ë³‘í•© / ë¶„í•  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mergeSelected() {
  // ê°™ì€ ìŠ¬ë¡¯ì˜ loc+date ì„ íƒ â†’ metaMerged
  const bySlot = {};
  selectedCells.forEach(key => {
    const [si,ct] = key.split(':');
    if (!bySlot[si]) bySlot[si] = [];
    bySlot[si].push(ct);
  });
  let merged = false;
  Object.entries(bySlot).forEach(([si, cts]) => {
    const i = +si;
    if (cts.includes('loc') && cts.includes('date') && !slotData[i].metaMerged) {
      // ì¼ì‹œ ê°’ì„ ìœ„ì¹˜ë¡œ í•©ì¹˜ê¸°
      if (slotData[i].date) slotData[i].location += (slotData[i].location?' ':'')+slotData[i].date;
      slotData[i].metaMerged = true;
      merged = true;
    } else if (cts.length === 1 && cts[0]==='loc' && !slotData[i].metaMerged) {
      slotData[i].metaMerged = true; merged = true;
    }
  });
  if (!merged) { showToast('ìœ„ì¹˜+ì¼ì‹œ ì…€ì„ í•¨ê»˜ ì„ íƒí•˜ê±°ë‚˜ ìœ„ì¹˜ ì…€ë§Œ ì„ íƒí•˜ì„¸ìš”'); return; }
  selectedCells.clear();
  renderGrid();
  showToast('âœ… ìœ„ì¹˜/ì¼ì‹œ í–‰ ë³‘í•©ë¨');
}

function splitSelected() {
  const bySlot = {};
  selectedCells.forEach(key => {
    const [si] = key.split(':');
    bySlot[si] = true;
  });
  let found = false;
  Object.keys(bySlot).forEach(si => {
    if (slotData[+si].metaMerged) { slotData[+si].metaMerged = false; found = true; }
  });
  if (!found) { showToast('ë³‘í•©ëœ ì…€ì´ ì—†ìŠµë‹ˆë‹¤'); return; }
  selectedCells.clear();
  renderGrid();
  showToast('âœ… ë¶„í• ë¨');
}

function onPhotoSelect(e, i) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    slotData[i].imgSrc = ev.target.result;
    renderGrid();
  };
  reader.readAsDataURL(file);
}

function delPhoto(i) {
  slotData[i].imgSrc = '';
  renderGrid();
}

// â”€â”€ ì¹¸ ìˆ˜ ì¡°ì ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setSlotCount(n) {
  slotCount = n;
  initSlots(n);
}
function addSlot() {
  if (slotCount >= 12) { showToast('ìµœëŒ€ 12ì¹¸ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤'); return; }
  slotCount++;
  initSlots(slotCount);
}
function removeSlot() {
  if (slotCount <= 2) return;
  slotCount--;
  renderGrid();
}

// â”€â”€ í—¤ë” ë™ê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncSiteName(v) { document.getElementById('sheetSite').value = v; }
function syncTitle(v) {
  const el = document.getElementById('sheetTitle');
  if (el) el.textContent = v;
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetForm() {
  if (!confirm('ì‘ì„± ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  slotData.length = 0;
  initSlots(slotCount);
  document.getElementById('siteName').value = '';
  document.getElementById('sheetSite').value = '';
  showToast('ì´ˆê¸°í™”ë¨');
}

// â”€â”€ PDF ì €ì¥ (ë¸Œë¼ìš°ì € ì¸ì‡„) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function printPDF() {
  showToast('ì¸ì‡„ ì°½ì—ì„œ "PDFë¡œ ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”');
  setTimeout(() => window.print(), 500);
}

// â”€â”€ ì—‘ì…€ ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportExcel() {
  const wb = XLSX.utils.book_new();
  const siteName = document.getElementById('sheetSite').value || '';
  const docTitle = document.getElementById('docTitle').value || 'ì‚¬ì§„ëŒ€ì§€';

  // í—¤ë” í–‰
  const rows = [
    [docTitle, '', 'í˜„ì¥ëª…:', siteName],
    [],
  ];

  // ê° ìŠ¬ë¡¯ ë°ì´í„°
  for (let i = 0; i < slotCount; i++) {
    const d = slotData[i];
    rows.push([`[ì‚¬ì§„ ${i+1}]`, '', '', '']);
    rows.push(['ìœ„ì¹˜', d.location, 'ì¼ì‹œ', d.date]);
    rows.push(['ë‚´ìš©', d.desc, '', '']);
    rows.push([]); // ë¹ˆ í–‰ (ì‚¬ì§„ ì˜ì—­)
    rows.push([]); rows.push([]); rows.push([]);
  }

  const ws = XLSX.utils.aoa_to_sheet(rows);

  // ì—´ ë„ˆë¹„
  ws['!cols'] = [
    {wch:8},{wch:25},{wch:8},{wch:25}
  ];

  // í—¤ë” ë³‘í•©
  ws['!merges'] = [
    {s:{r:0,c:0},e:{r:0,c:1}}, // ì œëª©
    {s:{r:0,c:3},e:{r:0,c:3}}, // í˜„ì¥ëª…ê°’
  ];

  XLSX.utils.book_append_sheet(wb, ws, 'ì‚¬ì§„ëŒ€ì§€');

  const today = new Date();
  const ymd = today.getFullYear()+String(today.getMonth()+1).padStart(2,'0')+String(today.getDate()).padStart(2,'0');
  XLSX.writeFile(wb, `ì‚¬ì§„ëŒ€ì§€_${ymd}.xlsx`);
  showToast('âœ… ì—‘ì…€ íŒŒì¼ì´ ì €ì¥ëìŠµë‹ˆë‹¤');
}

// â”€â”€ ìŠ¤ì¼€ì¼ ì¡°ì • (í™”ë©´ ë„ˆë¹„ì— ë”°ë¼) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateScale() {
  const wrap = document.getElementById('scaleWrap');
  const available = window.innerWidth - 40;
  const sheetW = 794;
  const scale = Math.min(1, available / sheetW);
  wrap.style.transform = `scale(${scale})`;
  wrap.style.marginBottom = `${(1 - scale) * -1123 * 0.5}px`;
}

// â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 2500);
}

// â”€â”€ ì‹œì‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initSlots(6);
updateScale();
window.addEventListener('resize', updateScale);

// ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
const today = new Date();
const todayStr = today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
slotData.forEach(d => { if(!d.date) d.date = todayStr; });
renderGrid();

// í´ë¦­ ì™¸ë¶€ â†’ ì„ íƒ í•´ì œ
document.addEventListener('click', e => {
  if (!e.target.closest('.cell-selectable') && !e.target.closest('.format-bar')) {
    selectedCells.clear();
    selectedHeaderCell = null;
    document.querySelectorAll('.cell-selected').forEach(el => el.classList.remove('cell-selected'));
    updateFmtHint();
  }
});
</script>
</body>
</html>
